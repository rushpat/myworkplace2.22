(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{10:function(e,t,n){},20:function(e,t,n){e.exports=n(35)},25:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(17),s=n.n(r),c=(n(25),n(1)),l=n.n(c),i=n(2),u=n(4),m=n(5),d=n(7),f=n(6),p=n(8),g=(n(10),function(){var e=Object(i.a)(l.a.mark((function e(t,n,a,o,r,s){var c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In createoffer"),e.prev=1,console.log(t),console.log(n),t.addStream(n),console.log("1"),e.next=8,t.createOffer();case 8:return c=e.sent,console.log("2"),e.next=12,t.setLocalDescription(c);case 12:console.log("3"),o(a,c,r,s),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t,n,a,o,r,s){return e.apply(this,arguments)}}()),v=function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In initiatelocalstream"),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 4:return t=e.sent,e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=Object(i.a)(l.a.mark((function e(){var t,n,a,o,r,s,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In initiateconnection"),e.prev=1,t={iceServers:[{urls:"stun:stun2.1.google.com:19302"}]},n={iceServers:[{urls:"stun:stun3.1.google.com:19302"}]},a={iceServers:[{urls:"stun:stun4.1.google.com:19302"}]},o=new RTCPeerConnection({iceServers:[{urls:"stun:stun1.1.google.com:19302"}]}),r=new RTCPeerConnection(t),s=new RTCPeerConnection(n),c=new RTCPeerConnection(a),console.log(o),console.log(r),i=[o,r,s,c],console.log(i[0]),e.abrupt("return",i);case 17:e.prev=17,e.t0=e.catch(1),console.error(e.t0);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(){return e.apply(this,arguments)}}(),b=function(e,t,n,a,o,r){console.log("In listentoconnectionevents"),e.onicecandidate=function(e){e.candidate&&r(n,e.candidate,a,t)},e.ontrack=function(e){o.srcObject!==e.streams[0]&&(o.srcObject=e.streams[0])}},E=function(){var e=Object(i.a)(l.a.mark((function e(t,n,a,o,r,s){var c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In sendanswer"),e.prev=1,t.addStream(n),console.log("1"),c=JSON.parse(a.offer),console.log("2"),t.setRemoteDescription(c),console.log("3"),e.next=10,t.createAnswer();case 10:i=e.sent,console.log("4"),t.setLocalDescription(i),console.log("5"),o(a.from,i,r,s),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),console.error(e.t0);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t,n,a,o,r,s){return e.apply(this,arguments)}}(),y=function(e,t){console.log("In startcall");var n=JSON.parse(t.answer);e.setRemoteDescription(n)},S=function(e,t){console.log("In addcandidate");var n=JSON.parse(t.candidate);e.addIceCandidate(new RTCIceCandidate(n))},w=n(3),R=n.n(w),C=(n(16),{apiKey:"AIzaSyAVOiv8F5oWqs4CL7NlngzE_3XFiSOi5O4",authDomain:"workplace-app-fb.firebaseapp.com",databaseURL:"https://workplace-app-fb-default-rtdb.firebaseio.com",projectId:"workplace-app-fb",storageBucket:"workplace-app-fb.appspot.com",messagingSenderId:"324667218234",appId:"1:324667218234:web:70a04ff69590074e245803"}),N=function(){var e=Object(i.a)(l.a.mark((function e(t,n,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In doLogin"),e.next=3,n.ref("/notifs/"+t).remove();case 3:n.ref("/notifs/"+t).on("value",(function(e){e.exists()&&a(e.val(),t)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),x=function(){var e=Object(i.a)(l.a.mark((function e(t,n,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In removenotifs"),e.next=3,t.ref("/notifs/"+n).remove();case 3:return e.next=5,t.ref("/notifs/"+a).remove();case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),O=function(){var e=Object(i.a)(l.a.mark((function e(t,n,a,o){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In doOffer"),e.next=3,a.ref("/notifs/"+t).set({type:"offer",from:o,offer:JSON.stringify(n)});case 3:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),k=function(){var e=Object(i.a)(l.a.mark((function e(t,n,a,o){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In doAnswer"),e.next=3,a.ref("/notifs/"+t).update({type:"answer",from:o,answer:JSON.stringify(n)});case 3:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),L=function(){var e=Object(i.a)(l.a.mark((function e(t,n,a,o){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In docandidate"),e.next=3,a.ref("/notifs/"+t).update({type:"candidate",from:o,candidate:JSON.stringify(n)});case 3:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),I=(n(34),n(19)),j=n.n(I),D=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,e))).componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("In component did mount"),n.setState({isLoggedIn:!0});case 2:case"end":return e.stop()}}),e)}))),n.renderVideos=function(){return o.a.createElement("div",{className:j()("videos",{active:n.state.isLoggedIn})},o.a.createElement("div",null,o.a.createElement("label",null,n.state.username),o.a.createElement("video",{ref:n.props.setLocalVideoRef,autoPlay:!0,playsInline:!0})),o.a.createElement("div",null,o.a.createElement("label",null,n.props.connectedUser),o.a.createElement("video",{ref:n.props.setRemoteVideoRef,autoPlay:!0,playsInline:!0})),o.a.createElement("div",null,o.a.createElement("label",null,n.props.connectedUser2),o.a.createElement("video",{ref:n.props.setRemoteVideoRef2,autoPlay:!0,playsInline:!0})))},n.renderForms=function(){return n.state.isLoggedIn?o.a.createElement("div",{key:"a",className:"form"},o.a.createElement("label",null,"Call to"),o.a.createElement("input",{value:n.state.userToCall,type:"text",onChange:function(e){return n.setState({userToCall:e.target.value})}}),o.a.createElement("button",{onClick:n.onStartCallClicked,id:"call-btn",className:"btn btn-primary"},"Call")):o.a.createElement("div",{key:"b",className:"form"},o.a.createElement("label",null,"Type a name"),o.a.createElement("input",{value:n.state.username,type:"text",onChange:function(e){return n.setState({username:e.target.value})}}),o.a.createElement("button",{id:"login-btn",className:"btn btn-primary"},"Login"))},n.state={isLoggedIn:!1,userToCall:null,username:n.props.username,team:n.props.team},console.log(n.state.username),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement("section",{id:"container"},this.props.connectedUser?null:this.renderForms(),this.renderVideos())}}]),t}(o.a.Component),U=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,e))).componentDidMount=Object(i.a)(l.a.mark((function e(){var t,a,o,r,s,c,i,u,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In component did mount"),console.log(n.state.username),e.next=4,v();case 4:return t=e.sent,e.next=7,v();case 7:return a=e.sent,e.next=10,v();case 10:return o=e.sent,e.next=13,v();case 13:return r=e.sent,s=[t,a,o,r],e.next=17,h();case 17:return c=e.sent,console.log(c[0]),i=c[n.state.counter],u=s[n.state.counter],n.localVideoRef.srcObject=s[0],n.setState({database:R.a.database(),localStream:u,localStreamSet:s,localConnectionSet:c,localConnection:i}),e.next=25,n.onLogin(n.state.username);case 25:0!==(m=n.state.team).length&&n.startCall(n.state.username,m[0]);case 27:case"end":return e.stop()}}),e)}))),n.startCall=function(){var e=Object(i.a)(l.a.mark((function e(t,a){var o,r,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("In starting call"),n.setState({calling:!0}),o=n.state.database,r=n.state.localConnection,s=n.state.localStream,c=n.state.counter,console.log("next is counter"),console.log(c),0===c&&(console.log("number 1"),console.log(r),console.log("number 1"),console.log(n.remoteVideoRef),console.log("number 1"),console.log(L),console.log("number 1"),b(r,t,a,o,n.remoteVideoRef,L)),1===c&&b(r,t,a,o,n.remoteVideoRef2,L),2===c&&b(r,t,a,o,n.remoteVideoRef3,L),console.log(r),g(r,s,a,O,o,t);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.onLogin=function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In onlogin"),e.next=3,N(t,n.state.database,n.handleUpdate);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.setLocalVideoRef=function(e){console.log("In setlocalvideoref"),n.localVideoRef=e},n.setRemoteVideoRef=function(e){console.log("In setremotevideoref"),n.remoteVideoRef=e},n.setRemoteVideoRef2=function(e){console.log("In setremotevideoref2"),n.remoteVideoRef2=e},n.handleUpdate=function(e,t){console.log("In handleupdate");var a=n.state,o=a.localConnection,r=a.database,s=a.localStream,c=n.state.counter,l=n.state.calling,i=n.state.username,u=n.state.called,m=n.state.connectedUser,d=n.state.connectedUser2;if(console.log(m),e)switch(e.type){case"offer":console.log("case offer"),0===c&&(n.setState({connectedUser:e.from}),b(o,t,e.from,r,n.remoteVideoRef,L)),1===c&&(n.setState({connectedUser2:e.from}),b(o,t,e.from,r,n.remoteVideoRef2,L)),E(o,s,e,k,r,t),n.setState({called:"CALLED"});break;case"answer":console.log("case answer"),0===c&&n.setState({connectedUser:e.from}),1===c&&n.setState({connectedUser2:e.from}),y(o,e);break;case"candidate":console.log("case candidate"),S(o,e),!0===l&&(n.setState({calling:!1}),0===c&&x(r,i,m),1===c&&x(r,i,d),c+=1,n.setState({counter:c})),"CALLED8"===u&&(n.setState({called:""}),c+=1,n.setState({counter:c})),"CALLED7"===u&&n.setState({called:"CALLED8"}),"CALLED6"===u&&n.setState({called:"CALLED7"}),"CALLED5"===u&&n.setState({called:"CALLED6"}),"CALLED4"===u&&(1===c&&(d.substring(0,d.length-6)===i.substring(0,i.length-6)?(n.setState({called:""}),c+=1,n.setState({counter:c})):n.setState({called:"CALLED5"})),0===c&&(m.substring(0,m.length-6)===i.substring(0,i.length-6)?(n.setState({called:""}),c+=1,n.setState({counter:c})):n.setState({called:"CALLED5"}))),"CALLED3"===u&&n.setState({called:"CALLED4"}),"CALLED2"===u&&n.setState({called:"CALLED3"}),"CALLED"===u&&n.setState({called:"CALLED2"})}},n.state={database:null,connectedUser:null,connectedUser2:null,connectedUser3:null,localStream:null,localStreamSet:null,localConnectionSet:null,localConnection:null,username:n.props.username,team:n.props.team,counter:0,calling:!1},n.localVideoRef=o.a.createRef(),n.remoteVideoRef=o.a.createRef(),n.remoteVideoRef2=o.a.createRef(),n.remoteVideoRef3=o.a.createRef(),n.remoteVideoRef4=o.a.createRef(),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.database===t.database&&(this.state.localStream===t.localStream&&this.state.localConnection===t.localConnection)}},{key:"componentDidUpdate",value:function(e,t){console.log("In component did update");var n=this.state.counter;console.log(n);var a=this.state.team,o=this.state.localConnectionSet,r=this.state.localStreamSet;if(t.counter!==n){console.log("changing connection and stream"),console.log("previous connection"),console.log(this.state.localConnection),console.log(this.state.localStream);var s=o[n],c=r[n];console.log("new connection"),console.log(s),console.log(c),this.setState({localConnection:s}),this.setState({localStream:c}),console.log("checking state 1"),console.log(this.state.localConnection),console.log(this.state.localStream)}t.counter!==n&&n<a.length&&(console.log("will be connecting to new user"),this.setState({calling:!0},(function(){console.log("async setstate"),this.startCall(this.state.username,a[n])})))}},{key:"render",value:function(){return o.a.createElement(D,{startCall:this.startCall,onLogin:this.onLogin,setLocalVideoRef:this.setLocalVideoRef,setRemoteVideoRef:this.setRemoteVideoRef,setRemoteVideoRef2:this.setRemoteVideoRef2,connectedUser:this.state.connectedUser,connectedUser2:this.state.connectedUser2,username:this.state.username,team:this.state.team})}}]),t}(o.a.Component),A=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,e))).componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("COMPONENT DID MOUNT"),R.a.initializeApp(C),e.next=4,n.getUserData();case 4:case"end":return e.stop()}}),e)}))),n.writeUserData=function(){console.log("SAVING DATA"),R.a.database().ref("/rooms").set(n.state.rooms),R.a.database().ref("/roomusers").set(n.state.room_users)},n.errData=function(e){console.log("GOT AN ERROR"),console.log(e)},n.nameNewRoom=function(){console.log("NAMING NEW ROOM"),n.setState({active:0})},n.enterRoom=function(e){console.log("ENTERING ROOM"+e.id);var t=n.state.room_users;t.push({ip:n.state.user,room:e.id}),n.setState({room_users:t}),n.setState({active:e.id+1}),n.findTeam(e.id)},n.authenticateUser=function(){console.log("AUTHENTICATING USER"),n.setState({active:-1})},n.constructRoom=function(){console.log("CREATING ROOM");var e=n.state.rooms;e.push({id:e.length}),n.setState({rooms:e});var t=n.state.room_users;t.push({ip:n.state.user,room:e.length-1}),n.setState({room_users:t}),n.setState({active:e.length}),n.findTeam(e.length-1)},n.findTeam=function(e){console.log(e);var t=n.state.room_users,a=[],o=!0,r=!1,s=void 0;try{for(var c,l=t[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var i=c.value;i.room===e&&i.ip!==n.state.user&&(console.log(i.ip),a.push(i.ip))}}catch(u){r=!0,s=u}finally{try{o||null==l.return||l.return()}finally{if(r)throw s}}console.log(a),n.setState({team:a})},n.leaveRoom=function(){console.log("LEAVING ROOM");var e=n.state.room_users,t=n.state.user,a=e.filter((function(e,n,a){if(e.ip!==t)return e}));n.setState({room_users:a}),n.setState({team:[]}),n.setState({active:-1})},n.state={retreivedData:!1,user:"",active:-2,busy:!1,roomname:"",team:[],rooms:[],room_users:[]},fetch("https://api.ipify.org?format=jsonp?callback=?",{method:"GET",headers:{}}).then((function(e){return e.text()})).then((function(e){var t=Math.floor(1e3*Math.random())+1e4,a=e.split(".").join("");n.setState({user:a+t}),console.log(n.state.user)})),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(e,t){!1!==this.state.retreivedData&&!0===this.state.retreivedData&&(console.log("COMPONENT DID UPDATE"),t!==this.state&&this.writeUserData())}},{key:"getUserData",value:function(){var e=Object(i.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("RETREIVING DATA"),e.next=3,R.a.database().ref("rooms").once("value").then((function(e){t.gotRooms(e)}));case 3:return e.next=5,R.a.database().ref("roomusers").once("value").then((function(e){t.gotRoomUsers(e)}));case 5:this.setState({retreivedData:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gotRooms",value:function(e){console.log("GOT ROOMS");var t=e.val(),n=Object.keys(t).map((function(e){return{id:t[e].id}}));this.setState({rooms:n})}},{key:"gotRoomUsers",value:function(e){console.log("GOT ROOMUSERS");var t=e.val(),n=Object.keys(t).map((function(e){return{ip:t[e].ip,room:t[e].room}}));this.setState({room_users:n})}},{key:"render",value:function(){var e=this,t=this.state.rooms,n=(this.state.room_users,this.state.active);return-2===n?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"container-fluid"},o.a.createElement("div",{className:"row align-items-center bg-primary"},o.a.createElement("div",{className:"col-xl-12"},o.a.createElement("h1",{className:"display-1 text-center"},"myWorkplace")),o.a.createElement("div",{className:"col-xl-12"},o.a.createElement("p",{className:"text-center text-light"},"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations."))),o.a.createElement("div",{className:"row mt-5"}),o.a.createElement("div",{className:"row d-flex justify-content-around"},o.a.createElement("button",{onClick:function(){return e.authenticateUser()},className:"btn btn-primary"},"Click to enter myWorkplace")))):-1===n?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"container-fluid"},o.a.createElement("div",{className:"row align-items-center bg-primary"},o.a.createElement("div",{className:"col-xl-12"},o.a.createElement("h1",{className:"display-1 text-center"},"myWorkplace")),o.a.createElement("div",{className:"col-xl-12"},o.a.createElement("p",{className:"text-center text-light"},"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations."))),o.a.createElement("div",{className:"row mt-5"}),o.a.createElement("div",{className:"row d-flex justify-content-around"},t.map((function(t){return o.a.createElement("div",{className:"col-sm-4 d-flex justify-content-around"},o.a.createElement("div",{key:t.id+1,style:{width:"18rem",marginRight:"1rem",textAlign:"center"}},o.a.createElement("div",{className:"card-body"},o.a.createElement("h5",{className:"card-title"},t.id+1),o.a.createElement("p",{className:"card-text"},"List users here"),o.a.createElement("button",{onClick:function(){return e.enterRoom(t)},className:"btn btn-link"},"Enter room"))))}))),o.a.createElement("div",{className:"row mt-5"}),o.a.createElement("div",{className:"row d-flex justify-content-around"},o.a.createElement("button",{onClick:function(){return e.constructRoom()},className:"btn btn-primary"},"Create New Room")))):o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"container-fluid"},o.a.createElement("div",{className:"row align-items-center bg-primary"},o.a.createElement("div",{className:"col-xl-12"},o.a.createElement("h1",{className:"display-1 text-center"},"myWorkplace")),o.a.createElement("div",{className:"col-xl-12"},o.a.createElement("p",{className:"text-center text-light"},"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations."))),o.a.createElement("div",{className:"row mt-5"}),o.a.createElement("div",{className:"row d-flex justify-content-around"},"In room ",n),o.a.createElement("div",{className:"row mt-5"}),o.a.createElement(U,{username:this.state.user,team:this.state.team}),o.a.createElement("div",{className:"row mt-5"}),o.a.createElement("div",{className:"row d-flex justify-content-around"},o.a.createElement("button",{onClick:function(){return e.leaveRoom()},className:"btn btn-primary"},"Leave room ",n))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[20,1,2]]]);
//# sourceMappingURL=main.0d277147.chunk.js.map