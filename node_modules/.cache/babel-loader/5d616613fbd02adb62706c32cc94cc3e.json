{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import\"./App.css\";import VideoChatContainer from\"./VideoChatContainer\";import firebase from\"firebase/app\";import config from\"./config\";var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);function App(props){var _this;_classCallCheck(this,App);_this=_possibleConstructorReturn(this,_getPrototypeOf(App).call(this,props));_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://component mounts, only after the first render on the client side\nconsole.log(\"COMPONENT DID MOUNT\");firebase.initializeApp(config);//this.writeUserData();\n_context.next=4;return _this.getUserData();case 4:case\"end\":return _context.stop();}}},_callee);}));_this.writeUserData=function(){//save the state\nconsole.log(\"SAVING DATA\");firebase.database().ref(\"/rooms\").set(_this.state.rooms);firebase.database().ref(\"/roomusers\").set(_this.state.room_users);};_this.errData=function(err){console.log(\"GOT AN ERROR\");console.log(err);};_this.nameNewRoom=function(){console.log(\"NAMING NEW ROOM\");_this.setState({active:0});};_this.enterRoom=function(room){console.log(\"ENTERING ROOM\"+room.id);var temp_roomusers=_this.state.room_users;temp_roomusers.push({ip:_this.state.user,room:room.id});_this.setState({room_users:temp_roomusers});_this.setState({active:room.id+1});_this.findTeam(room.id);};_this.authenticateUser=function(){console.log(\"AUTHENTICATING USER\");_this.setState({active:-1});};_this.constructRoom=function(){console.log(\"CREATING ROOM\");var temp_rooms=_this.state.rooms;temp_rooms.push({id:temp_rooms.length});_this.setState({rooms:temp_rooms});var temp_roomusers=_this.state.room_users;temp_roomusers.push({ip:_this.state.user,room:temp_rooms.length-1});_this.setState({room_users:temp_roomusers});_this.setState({active:temp_rooms.length});_this.findTeam(temp_rooms.length-1);};_this.findTeam=function(id){console.log(id);var room_users=_this.state.room_users;var team=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=room_users[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var roomuser=_step.value;if(roomuser.room===id&&roomuser.ip!==_this.state.user){console.log(roomuser.ip);team.push(roomuser.ip);}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}console.log(team);_this.setState({team:team});};_this.leaveRoom=function(){console.log(\"LEAVING ROOM\");var room_users=_this.state.room_users;var user=_this.state.user;var filteredru=room_users.filter(function(value,index,arr){if(value.ip!==user){return value;}});_this.setState({room_users:filteredru});_this.setState({team:[]});_this.setState({active:-1});};_this.state={retreivedData:false,//probing end of componentDidMount\nuser:\"\",//ip address\nactive:-2,//-2 for no activity; -1 is not in a room, 0 is new room, otherwise room number + 1\nbusy:false,//boolean for whether in Teams meeting or not\nroomname:\"\",team:[],rooms:[],//list of rooms and their IDs, which is their index within the array\nroom_users:[]//entry of ip address and room IDs +1\n};fetch(\"https://api.ipify.org?format=jsonp?callback=?\",{method:\"GET\",headers:{}}).then(function(res){return res.text();}).then(function(ip){var rand=Math.floor(Math.random()*1000)+10000;var yip=ip.split(\".\").join(\"\");_this.setState({user:yip+rand});console.log(_this.state.user);});return _this;}_createClass(App,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){//before completion of componentDidMount\nif(this.state.retreivedData===false){return;}//after completion of componentDidMount\nif(this.state.retreivedData===true){console.log(\"COMPONENT DID UPDATE\");if(prevState!==this.state){this.writeUserData();}}}},{key:\"getUserData\",value:function(){var _getUserData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this2=this;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0://retrieve data from firebase\nconsole.log(\"RETREIVING DATA\");_context2.next=3;return firebase.database().ref(\"rooms\").once(\"value\").then(function(snapshot){_this2.gotRooms(snapshot);});case 3:_context2.next=5;return firebase.database().ref(\"roomusers\").once(\"value\").then(function(snapshot){_this2.gotRoomUsers(snapshot);});case 5:this.setState({retreivedData:true});case 6:case\"end\":return _context2.stop();}}},_callee2,this);}));function getUserData(){return _getUserData.apply(this,arguments);}return getUserData;}()},{key:\"gotRooms\",value:function gotRooms(data){console.log(\"GOT ROOMS\");var temp_rooms=data.val();var parsed_rooms=Object.keys(temp_rooms).map(function(room){return{id:temp_rooms[room].id};});this.setState({rooms:parsed_rooms});}},{key:\"gotRoomUsers\",value:function gotRoomUsers(data){console.log(\"GOT ROOMUSERS\");var temp_roomusers=data.val();var parsed_roomusers=Object.keys(temp_roomusers).map(function(roomuser){return{ip:temp_roomusers[roomuser].ip,room:temp_roomusers[roomuser].room};});this.setState({room_users:parsed_roomusers});}},{key:\"render\",value:function render(){var _this3=this;var rooms=this.state.rooms;var room_users=this.state.room_users;var active=this.state.active;if(active===-2){return React.createElement(React.Fragment,null,React.createElement(\"div\",{className:\"container-fluid\"},React.createElement(\"div\",{className:\"row align-items-center bg-primary\"},React.createElement(\"div\",{className:\"col-xl-12\"},React.createElement(\"h1\",{className:\"display-1 text-center\"},\"myWorkplace\")),React.createElement(\"div\",{className:\"col-xl-12\"},React.createElement(\"p\",{className:\"text-center text-light\"},\"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations.\"))),React.createElement(\"div\",{className:\"row mt-5\"}),React.createElement(\"div\",{className:\"row d-flex justify-content-around\"},React.createElement(\"button\",{onClick:function onClick(){return _this3.authenticateUser();},className:\"btn btn-primary\"},\"Click to enter myWorkplace\"))));}if(active===-1){return React.createElement(React.Fragment,null,React.createElement(\"div\",{className:\"container-fluid\"},React.createElement(\"div\",{className:\"row align-items-center bg-primary\"},React.createElement(\"div\",{className:\"col-xl-12\"},React.createElement(\"h1\",{className:\"display-1 text-center\"},\"myWorkplace\")),React.createElement(\"div\",{className:\"col-xl-12\"},React.createElement(\"p\",{className:\"text-center text-light\"},\"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations.\"))),React.createElement(\"div\",{className:\"row mt-5\"}),React.createElement(\"div\",{className:\"row d-flex justify-content-around\"},rooms.map(function(room){return React.createElement(\"div\",{className:\"col-sm-4 d-flex justify-content-around\"},React.createElement(\"div\",{key:room.id+1,style:{width:\"18rem\",marginRight:\"1rem\",textAlign:\"center\"}},React.createElement(\"div\",{className:\"card-body\"},React.createElement(\"h5\",{className:\"card-title\"},room.id+1),React.createElement(\"p\",{className:\"card-text\"},\"List users here\"),React.createElement(\"button\",{onClick:function onClick(){return _this3.enterRoom(room);},className:\"btn btn-link\"},\"Enter room\"))));})),React.createElement(\"div\",{className:\"row mt-5\"}),React.createElement(\"div\",{className:\"row d-flex justify-content-around\"},React.createElement(\"button\",{onClick:function onClick(){return _this3.constructRoom();},className:\"btn btn-primary\"},\"Create New Room\"))));}return React.createElement(React.Fragment,null,React.createElement(\"div\",{className:\"container-fluid\"},React.createElement(\"div\",{className:\"row align-items-center bg-primary\"},React.createElement(\"div\",{className:\"col-xl-12\"},React.createElement(\"h1\",{className:\"display-1 text-center\"},\"myWorkplace\")),React.createElement(\"div\",{className:\"col-xl-12\"},React.createElement(\"p\",{className:\"text-center text-light\"},\"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations.\"))),React.createElement(\"div\",{className:\"row mt-5\"}),React.createElement(\"div\",{className:\"row d-flex justify-content-around\"},\"In room \",active),React.createElement(\"div\",{className:\"row mt-5\"}),React.createElement(VideoChatContainer,{username:this.state.user,team:this.state.team}),React.createElement(\"div\",{className:\"row mt-5\"}),React.createElement(\"div\",{className:\"row d-flex justify-content-around\"},React.createElement(\"button\",{onClick:function onClick(){return _this3.leaveRoom();},className:\"btn btn-primary\"},\"Leave room \",active))));//return (\n//  <div className=\"app\">\n//    <h1>React Video Chat App</h1>\n//    <h2>WebRTC + Firebase</h2>\n//    <VideoChatContainer />\n//  </div>\n//);\n}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/rushipat/Documents/Data/Programs/videochatapp/src/App.js"],"names":["React","Component","VideoChatContainer","firebase","config","App","props","componentDidMount","console","log","initializeApp","getUserData","writeUserData","database","ref","set","state","rooms","room_users","errData","err","nameNewRoom","setState","active","enterRoom","room","id","temp_roomusers","push","ip","user","findTeam","authenticateUser","constructRoom","temp_rooms","length","team","roomuser","leaveRoom","filteredru","filter","value","index","arr","retreivedData","busy","roomname","fetch","method","headers","then","res","text","rand","Math","floor","random","yip","split","join","prevProps","prevState","once","snapshot","gotRooms","gotRoomUsers","data","val","parsed_rooms","Object","keys","map","parsed_roomusers","width","marginRight","textAlign"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./App.css\";\nimport VideoChatContainer from \"./VideoChatContainer\";\nimport firebase from \"firebase/app\";\nimport config from \"./config\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      retreivedData: false, //probing end of componentDidMount\n      user: \"\", //ip address\n      active: -2, //-2 for no activity; -1 is not in a room, 0 is new room, otherwise room number + 1\n      busy: false, //boolean for whether in Teams meeting or not\n      roomname: \"\",\n      team: [],\n\n      rooms: [], //list of rooms and their IDs, which is their index within the array\n      room_users: [], //entry of ip address and room IDs +1\n    };\n\n    fetch(\"https://api.ipify.org?format=jsonp?callback=?\", {\n      method: \"GET\",\n      headers: {},\n    })\n      .then((res) => {\n        return res.text();\n      })\n      .then((ip) => {\n        const rand = Math.floor(Math.random() * 1000) + 10000;\n        const yip = ip.split(\".\").join(\"\");\n        this.setState({ user: yip + rand });\n        console.log(this.state.user);\n      });\n  }\n\n  componentDidMount = async () => {\n    //component mounts, only after the first render on the client side\n    console.log(\"COMPONENT DID MOUNT\");\n\n    firebase.initializeApp(config);\n\n    //this.writeUserData();\n\n    await this.getUserData();\n  };\n\n  componentDidUpdate(prevProps, prevState) {\n    //before completion of componentDidMount\n    if (this.state.retreivedData === false) {\n      return;\n    }\n\n    //after completion of componentDidMount\n    if (this.state.retreivedData === true) {\n      console.log(\"COMPONENT DID UPDATE\");\n      if (prevState !== this.state) {\n        this.writeUserData();\n      }\n    }\n  }\n\n  writeUserData = () => {\n    //save the state\n    console.log(\"SAVING DATA\");\n\n    firebase.database().ref(\"/rooms\").set(this.state.rooms);\n    firebase.database().ref(\"/roomusers\").set(this.state.room_users);\n  };\n\n  async getUserData() {\n    //retrieve data from firebase\n    console.log(\"RETREIVING DATA\");\n\n    await firebase\n      .database()\n      .ref(\"rooms\")\n      .once(\"value\")\n      .then((snapshot) => {\n        this.gotRooms(snapshot);\n      });\n\n    await firebase\n      .database()\n      .ref(\"roomusers\")\n      .once(\"value\")\n      .then((snapshot) => {\n        this.gotRoomUsers(snapshot);\n      });\n\n    this.setState({ retreivedData: true });\n  }\n\n  gotRooms(data) {\n    console.log(\"GOT ROOMS\");\n\n    const temp_rooms = data.val();\n    const parsed_rooms = Object.keys(temp_rooms).map((room) => {\n      return { id: temp_rooms[room].id };\n    });\n\n    this.setState({ rooms: parsed_rooms });\n  }\n\n  gotRoomUsers(data) {\n    console.log(\"GOT ROOMUSERS\");\n\n    const temp_roomusers = data.val();\n    const parsed_roomusers = Object.keys(temp_roomusers).map((roomuser) => {\n      return {\n        ip: temp_roomusers[roomuser].ip,\n        room: temp_roomusers[roomuser].room,\n      };\n    });\n\n    this.setState({ room_users: parsed_roomusers });\n  }\n\n  errData = (err) => {\n    console.log(\"GOT AN ERROR\");\n\n    console.log(err);\n  };\n\n  nameNewRoom = () => {\n    console.log(\"NAMING NEW ROOM\");\n    this.setState({ active: 0 });\n  };\n\n  enterRoom = (room) => {\n    console.log(\"ENTERING ROOM\" + room.id);\n\n    const temp_roomusers = this.state.room_users;\n\n    temp_roomusers.push({ ip: this.state.user, room: room.id });\n\n    this.setState({ room_users: temp_roomusers });\n\n    this.setState({ active: room.id + 1 });\n    this.findTeam(room.id);\n  };\n\n  authenticateUser = () => {\n    console.log(\"AUTHENTICATING USER\");\n    this.setState({ active: -1 });\n  };\n\n  constructRoom = () => {\n    console.log(\"CREATING ROOM\");\n\n    const temp_rooms = this.state.rooms;\n\n    temp_rooms.push({ id: temp_rooms.length });\n    this.setState({ rooms: temp_rooms });\n\n    const temp_roomusers = this.state.room_users;\n\n    temp_roomusers.push({ ip: this.state.user, room: temp_rooms.length - 1 });\n\n    this.setState({ room_users: temp_roomusers });\n\n    this.setState({ active: temp_rooms.length });\n    this.findTeam(temp_rooms.length - 1);\n  };\n\n  findTeam = (id) => {\n    console.log(id);\n    const room_users = this.state.room_users;\n    const team = [];\n\n    for (let roomuser of room_users) {\n      if (roomuser.room === id && roomuser.ip !== this.state.user) {\n        console.log(roomuser.ip);\n        team.push(roomuser.ip);\n      }\n    }\n\n    console.log(team);\n\n    this.setState({ team });\n  };\n\n  leaveRoom = () => {\n    console.log(\"LEAVING ROOM\");\n\n    const room_users = this.state.room_users;\n    const user = this.state.user;\n\n    var filteredru = room_users.filter(function (value, index, arr) {\n      if (value.ip !== user) {\n        return value;\n      }\n    });\n\n    this.setState({ room_users: filteredru });\n    this.setState({ team: [] });\n    this.setState({ active: -1 });\n  };\n\n  render() {\n    const { rooms } = this.state;\n    const { room_users } = this.state;\n    const { active } = this.state;\n\n    if (active === -2) {\n      return (\n        <React.Fragment>\n          <div className=\"container-fluid\">\n            <div className=\"row align-items-center bg-primary\">\n              <div className=\"col-xl-12\">\n                <h1 className=\"display-1 text-center\">myWorkplace</h1>\n              </div>\n              <div className=\"col-xl-12\">\n                <p className=\"text-center text-light\">\n                  myWorkplace is a prototype application intended to facilitate\n                  more spontanenous virtual conversations.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"row mt-5\"></div>\n\n            <div className=\"row d-flex justify-content-around\">\n              <button\n                onClick={() => this.authenticateUser()}\n                className=\"btn btn-primary\"\n              >\n                Click to enter myWorkplace\n              </button>\n            </div>\n          </div>\n        </React.Fragment>\n      );\n    }\n\n    if (active === -1) {\n      return (\n        <React.Fragment>\n          <div className=\"container-fluid\">\n            <div className=\"row align-items-center bg-primary\">\n              <div className=\"col-xl-12\">\n                <h1 className=\"display-1 text-center\">myWorkplace</h1>\n              </div>\n              <div className=\"col-xl-12\">\n                <p className=\"text-center text-light\">\n                  myWorkplace is a prototype application intended to facilitate\n                  more spontanenous virtual conversations.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"row mt-5\"></div>\n\n            <div className=\"row d-flex justify-content-around\">\n              {rooms.map((room) => (\n                <div className=\"col-sm-4 d-flex justify-content-around\">\n                  <div\n                    key={room.id + 1}\n                    style={{\n                      width: \"18rem\",\n                      marginRight: \"1rem\",\n                      textAlign: \"center\",\n                    }}\n                  >\n                    <div className=\"card-body\">\n                      <h5 className=\"card-title\">{room.id + 1}</h5>\n                      <p className=\"card-text\">List users here</p>\n                      <button\n                        onClick={() => this.enterRoom(room)}\n                        className=\"btn btn-link\"\n                      >\n                        Enter room\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"row mt-5\"></div>\n\n            <div className=\"row d-flex justify-content-around\">\n              <button\n                onClick={() => this.constructRoom()}\n                className=\"btn btn-primary\"\n              >\n                Create New Room\n              </button>\n            </div>\n          </div>\n        </React.Fragment>\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <div className=\"container-fluid\">\n          <div className=\"row align-items-center bg-primary\">\n            <div className=\"col-xl-12\">\n              <h1 className=\"display-1 text-center\">myWorkplace</h1>\n            </div>\n            <div className=\"col-xl-12\">\n              <p className=\"text-center text-light\">\n                myWorkplace is a prototype application intended to facilitate\n                more spontanenous virtual conversations.\n              </p>\n            </div>\n          </div>\n\n          <div className=\"row mt-5\"></div>\n\n          <div className=\"row d-flex justify-content-around\">\n            In room {active}\n          </div>\n\n          <div className=\"row mt-5\"></div>\n\n          <VideoChatContainer\n            username={this.state.user}\n            team={this.state.team}\n          />\n\n          <div className=\"row mt-5\"></div>\n\n          <div className=\"row d-flex justify-content-around\">\n            <button\n              onClick={() => this.leaveRoom()}\n              className=\"btn btn-primary\"\n            >\n              Leave room {active}\n            </button>\n          </div>\n        </div>\n      </React.Fragment>\n    );\n\n    //return (\n    //  <div className=\"app\">\n    //    <h1>React Video Chat App</h1>\n    //    <h2>WebRTC + Firebase</h2>\n    //    <VideoChatContainer />\n    //  </div>\n    //);\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}