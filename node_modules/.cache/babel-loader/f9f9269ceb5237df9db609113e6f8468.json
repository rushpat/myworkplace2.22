{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/inherits\";import React from\"react\";import\"./App.css\";import{createOffer,initiateConnection,startCall,sendAnswer,addCandidate,initiateLocalStream,listenToConnectionEvents}from\"./modules/RTCModule\";import firebase from\"firebase/app\";import\"firebase/database\";import config from\"./config\";import{doOffer,doAnswer,doLogin,doCandidate,removeNotifs}from\"./modules/FirebaseModule\";import\"webrtc-adapter\";import VideoChat from\"./VideoChat\";var VideoChatContainer=/*#__PURE__*/function(_React$Component){_inherits(VideoChatContainer,_React$Component);function VideoChatContainer(props){var _this;_classCallCheck(this,VideoChatContainer);_this=_possibleConstructorReturn(this,_getPrototypeOf(VideoChatContainer).call(this,props));_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var localStream1,localStream2,localStream3,localStream4,localStreamSet,localConnectionSet,localConnection,localStream,team;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// getting local video stream\nconsole.log(\"In component did mount\");console.log(_this.state.username);_context.next=4;return initiateLocalStream();case 4:localStream1=_context.sent;_context.next=7;return initiateLocalStream();case 7:localStream2=_context.sent;_context.next=10;return initiateLocalStream();case 10:localStream3=_context.sent;_context.next=13;return initiateLocalStream();case 13:localStream4=_context.sent;localStreamSet=[localStream1,localStream2,localStream3,localStream4];_context.next=17;return initiateConnection();case 17:localConnectionSet=_context.sent;console.log(localConnectionSet[0]);localConnection=localConnectionSet[_this.state.counter];localStream=localStreamSet[_this.state.counter];_this.localVideoRef.srcObject=localStreamSet[0];//this.localVideoRef2.srcObject = localStreamSet[1];\n//this.localVideoRef3.srcObject = localStreamSet[2];\n//this.localVideoRef4.srcObject = localStreamSet[3];\n_this.setState({database:firebase.database(),localStream:localStream,localStreamSet:localStreamSet,localConnectionSet:localConnectionSet,localConnection:localConnection});_context.next=25;return _this.onLogin(_this.state.username);case 25:team=_this.state.team;if(team.length!==0){_this.startCall(_this.state.username,team[0]);}case 27:case\"end\":return _context.stop();}}},_callee);}));_this.startCall=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(username,userToCall){var database,localConnection,localStream,counter;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(\"In starting call\");_this.setState({calling:true});database=_this.state.database;localConnection=_this.state.localConnection;localStream=_this.state.localStream;counter=_this.state.counter;console.log(\"next is counter\");console.log(counter);// listenToConnectionEvents(\n//   localConnection,\n//   username,\n//   userToCall,\n//   database,\n//   this.remoteVideoRef,\n//   doCandidate\n// );\nif(counter===0){console.log(\"number 1\");console.log(localConnection);console.log(\"number 1\");console.log(_this.remoteVideoRef);console.log(\"number 1\");console.log(doCandidate);console.log(\"number 1\");listenToConnectionEvents(localConnection,username,userToCall,database,_this.remoteVideoRef,doCandidate);}if(counter===1){listenToConnectionEvents(localConnection,username,userToCall,database,_this.remoteVideoRef2,doCandidate);}if(counter===2){listenToConnectionEvents(localConnection,username,userToCall,database,_this.remoteVideoRef3,doCandidate);}console.log(localConnection);// create an offer\ncreateOffer(localConnection,localStream,userToCall,doOffer,database,username);case 13:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}();_this.onLogin=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(username){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"In onlogin\");_context3.next=3;return doLogin(username,_this.state.database,_this.handleUpdate);case 3:return _context3.abrupt(\"return\",_context3.sent);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();_this.setLocalVideoRef=function(ref){console.log(\"In setlocalvideoref\");_this.localVideoRef=ref;};_this.setRemoteVideoRef=function(ref){console.log(\"In setremotevideoref\");_this.remoteVideoRef=ref;};_this.setRemoteVideoRef2=function(ref){console.log(\"In setremotevideoref2\");_this.remoteVideoRef2=ref;};_this.handleUpdate=function(notif,username){console.log(\"In handleupdate\");var _this$state=_this.state,localConnection=_this$state.localConnection,database=_this$state.database,localStream=_this$state.localStream;var counter=_this.state.counter;var calling=_this.state.calling;var user=_this.state.username;var called=_this.state.called;var connectedUser=_this.state.connectedUser;var connectedUser2=_this.state.connectedUser2;console.log(connectedUser);if(notif){switch(notif.type){case\"offer\":console.log(\"case offer\");if(counter===0){_this.setState({connectedUser:notif.from});listenToConnectionEvents(localConnection,username,notif.from,database,_this.remoteVideoRef,doCandidate);}if(counter===1){_this.setState({connectedUser2:notif.from});listenToConnectionEvents(localConnection,username,notif.from,database,_this.remoteVideoRef2,doCandidate);}sendAnswer(localConnection,localStream,notif,doAnswer,database,username);_this.setState({called:\"CALLED\"});break;case\"answer\":console.log(\"case answer\");if(counter===0){_this.setState({connectedUser:notif.from});}if(counter===1){_this.setState({connectedUser2:notif.from});}startCall(localConnection,notif);break;case\"candidate\":console.log(\"case candidate\");addCandidate(localConnection,notif);if(calling===true){_this.setState({calling:false});if(counter===0){removeNotifs(database,user,connectedUser);}if(counter===1){removeNotifs(database,user,connectedUser2);}counter=counter+1;_this.setState({counter:counter});}if(called===\"CALLED4\"){_this.setState({called:\"\"});counter=counter+1;_this.setState({counter:counter});}if(called===\"CALLED3\"){_this.setState({called:\"CALLED4\"});}if(called===\"CALLED2\"){_this.setState({called:\"CALLED3\"});}if(called===\"CALLED\"){_this.setState({called:\"CALLED2\"});}break;default:break;}}};_this.state={database:null,connectedUser:null,connectedUser2:null,connectedUser3:null,localStream:null,localStreamSet:null,localConnectionSet:null,localConnection:null,username:_this.props.username,team:_this.props.team,counter:0,calling:false};_this.localVideoRef=React.createRef();//this.localVideoRef2 = React.createRef();\n//this.localVideoRef3 = React.createRef();\n//this.localVideoRef4 = React.createRef();\n_this.remoteVideoRef=React.createRef();_this.remoteVideoRef2=React.createRef();_this.remoteVideoRef3=React.createRef();_this.remoteVideoRef4=React.createRef();return _this;}_createClass(VideoChatContainer,[{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState){if(this.state.database!==nextState.database){return false;}if(this.state.localStream!==nextState.localStream){return false;}if(this.state.localConnection!==nextState.localConnection){return false;}return true;}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){console.log(\"In component did update\");var counter=this.state.counter;console.log(counter);var team=this.state.team;var localConnectionSet=this.state.localConnectionSet;var localStreamSet=this.state.localStreamSet;if(prevState.counter!==counter){console.log(\"changing connection and stream\");console.log(\"previous connection\");console.log(this.state.localConnection);console.log(this.state.localStream);var localConn=localConnectionSet[counter];var localStr=localStreamSet[counter];console.log(\"new connection\");console.log(localConn);console.log(localStr);this.setState({localConnection:localConn});this.setState({localStream:localStr});console.log(\"checking state 1\");console.log(this.state.localConnection);console.log(this.state.localStream);}if(prevState.counter!==counter&&counter<team.length){console.log(\"will be connecting to new user\");this.setState({calling:true},function(){console.log(\"async setstate\");this.startCall(this.state.username,team[counter]);});}}},{key:\"render\",value:function render(){return React.createElement(VideoChat,{startCall:this.startCall,onLogin:this.onLogin,setLocalVideoRef:this.setLocalVideoRef,setRemoteVideoRef:this.setRemoteVideoRef,setRemoteVideoRef2:this.setRemoteVideoRef2,connectedUser:this.state.connectedUser,connectedUser2:this.state.connectedUser2,username:this.state.username,team:this.state.team});}}]);return VideoChatContainer;}(React.Component);export default VideoChatContainer;","map":{"version":3,"sources":["/Users/rushipat/Documents/Data/Programs/videochatapp/src/VideoChatContainer.js"],"names":["React","createOffer","initiateConnection","startCall","sendAnswer","addCandidate","initiateLocalStream","listenToConnectionEvents","firebase","config","doOffer","doAnswer","doLogin","doCandidate","removeNotifs","VideoChat","VideoChatContainer","props","componentDidMount","console","log","state","username","localStream1","localStream2","localStream3","localStream4","localStreamSet","localConnectionSet","localConnection","counter","localStream","localVideoRef","srcObject","setState","database","onLogin","team","length","userToCall","calling","remoteVideoRef","remoteVideoRef2","remoteVideoRef3","handleUpdate","setLocalVideoRef","ref","setRemoteVideoRef","setRemoteVideoRef2","notif","user","called","connectedUser","connectedUser2","type","from","connectedUser3","createRef","remoteVideoRef4","nextProps","nextState","prevProps","prevState","localConn","localStr","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport \"./App.css\";\nimport {\n  createOffer,\n  initiateConnection,\n  startCall,\n  sendAnswer,\n  addCandidate,\n  initiateLocalStream,\n  listenToConnectionEvents,\n} from \"./modules/RTCModule\";\nimport firebase from \"firebase/app\";\nimport \"firebase/database\";\nimport config from \"./config\";\nimport {\n  doOffer,\n  doAnswer,\n  doLogin,\n  doCandidate,\n  removeNotifs,\n} from \"./modules/FirebaseModule\";\nimport \"webrtc-adapter\";\nimport VideoChat from \"./VideoChat\";\n\nclass VideoChatContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      database: null,\n      connectedUser: null,\n      connectedUser2: null,\n      connectedUser3: null,\n      localStream: null,\n      localStreamSet: null,\n      localConnectionSet: null,\n      localConnection: null,\n      username: this.props.username,\n      team: this.props.team,\n      counter: 0,\n      calling: false,\n    };\n    this.localVideoRef = React.createRef();\n    //this.localVideoRef2 = React.createRef();\n    //this.localVideoRef3 = React.createRef();\n    //this.localVideoRef4 = React.createRef();\n    this.remoteVideoRef = React.createRef();\n    this.remoteVideoRef2 = React.createRef();\n    this.remoteVideoRef3 = React.createRef();\n    this.remoteVideoRef4 = React.createRef();\n  }\n\n  componentDidMount = async () => {\n    // getting local video stream\n    console.log(\"In component did mount\");\n\n    console.log(this.state.username);\n\n    const localStream1 = await initiateLocalStream();\n    const localStream2 = await initiateLocalStream();\n    const localStream3 = await initiateLocalStream();\n    const localStream4 = await initiateLocalStream();\n\n    const localStreamSet = [\n      localStream1,\n      localStream2,\n      localStream3,\n      localStream4,\n    ];\n\n    const localConnectionSet = await initiateConnection();\n\n    console.log(localConnectionSet[0]);\n\n    const localConnection = localConnectionSet[this.state.counter];\n\n    const localStream = localStreamSet[this.state.counter];\n\n    this.localVideoRef.srcObject = localStreamSet[0];\n    //this.localVideoRef2.srcObject = localStreamSet[1];\n    //this.localVideoRef3.srcObject = localStreamSet[2];\n    //this.localVideoRef4.srcObject = localStreamSet[3];\n\n    this.setState({\n      database: firebase.database(),\n      localStream,\n      localStreamSet,\n      localConnectionSet,\n      localConnection,\n    });\n\n    await this.onLogin(this.state.username);\n\n    const team = this.state.team;\n\n    if (team.length !== 0) {\n      this.startCall(this.state.username, team[0]);\n    }\n  };\n\n  shouldComponentUpdate(nextProps, nextState) {\n    if (this.state.database !== nextState.database) {\n      return false;\n    }\n    if (this.state.localStream !== nextState.localStream) {\n      return false;\n    }\n    if (this.state.localConnection !== nextState.localConnection) {\n      return false;\n    }\n\n    return true;\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log(\"In component did update\");\n\n    const counter = this.state.counter;\n    console.log(counter);\n    const team = this.state.team;\n    const localConnectionSet = this.state.localConnectionSet;\n    const localStreamSet = this.state.localStreamSet;\n\n    if (prevState.counter !== counter) {\n      console.log(\"changing connection and stream\");\n      console.log(\"previous connection\");\n      console.log(this.state.localConnection);\n      console.log(this.state.localStream);\n      var localConn = localConnectionSet[counter];\n      var localStr = localStreamSet[counter];\n      console.log(\"new connection\");\n      console.log(localConn);\n      console.log(localStr);\n      this.setState({ localConnection: localConn });\n      this.setState({ localStream: localStr });\n      console.log(\"checking state 1\");\n      console.log(this.state.localConnection);\n      console.log(this.state.localStream);\n    }\n\n    if (prevState.counter !== counter && counter < team.length) {\n      console.log(\"will be connecting to new user\");\n      this.setState({ calling: true }, function () {\n        console.log(\"async setstate\");\n        this.startCall(this.state.username, team[counter]);\n      });\n    }\n  }\n\n  startCall = async (username, userToCall) => {\n    console.log(\"In starting call\");\n    this.setState({ calling: true });\n\n    const { database } = this.state;\n    var localConnection = this.state.localConnection;\n    var localStream = this.state.localStream;\n    var counter = this.state.counter;\n    console.log(\"next is counter\");\n    console.log(counter);\n    // listenToConnectionEvents(\n    //   localConnection,\n    //   username,\n    //   userToCall,\n    //   database,\n    //   this.remoteVideoRef,\n    //   doCandidate\n    // );\n\n    if (counter === 0) {\n      console.log(\"number 1\");\n      console.log(localConnection);\n      console.log(\"number 1\");\n      console.log(this.remoteVideoRef);\n      console.log(\"number 1\");\n      console.log(doCandidate);\n      console.log(\"number 1\");\n      listenToConnectionEvents(\n        localConnection,\n        username,\n        userToCall,\n        database,\n        this.remoteVideoRef,\n        doCandidate\n      );\n    }\n    if (counter === 1) {\n      listenToConnectionEvents(\n        localConnection,\n        username,\n        userToCall,\n        database,\n        this.remoteVideoRef2,\n        doCandidate\n      );\n    }\n    if (counter === 2) {\n      listenToConnectionEvents(\n        localConnection,\n        username,\n        userToCall,\n        database,\n        this.remoteVideoRef3,\n        doCandidate\n      );\n    }\n\n    console.log(localConnection);\n\n    // create an offer\n\n    createOffer(\n      localConnection,\n      localStream,\n      userToCall,\n      doOffer,\n      database,\n      username\n    );\n  };\n\n  onLogin = async (username) => {\n    console.log(\"In onlogin\");\n    return await doLogin(username, this.state.database, this.handleUpdate);\n  };\n\n  setLocalVideoRef = (ref) => {\n    console.log(\"In setlocalvideoref\");\n    this.localVideoRef = ref;\n  };\n\n  setRemoteVideoRef = (ref) => {\n    console.log(\"In setremotevideoref\");\n    this.remoteVideoRef = ref;\n  };\n\n  setRemoteVideoRef2 = (ref) => {\n    console.log(\"In setremotevideoref2\");\n    this.remoteVideoRef2 = ref;\n  };\n\n  handleUpdate = (notif, username) => {\n    console.log(\"In handleupdate\");\n    const { localConnection, database, localStream } = this.state;\n    var counter = this.state.counter;\n    var calling = this.state.calling;\n    const user = this.state.username;\n    const called = this.state.called;\n    const connectedUser = this.state.connectedUser;\n    const connectedUser2 = this.state.connectedUser2;\n\n    console.log(connectedUser);\n\n    if (notif) {\n      switch (notif.type) {\n        case \"offer\":\n          console.log(\"case offer\");\n\n          if (counter === 0) {\n            this.setState({\n              connectedUser: notif.from,\n            });\n\n            listenToConnectionEvents(\n              localConnection,\n              username,\n              notif.from,\n              database,\n              this.remoteVideoRef,\n              doCandidate\n            );\n          }\n\n          if (counter === 1) {\n            this.setState({\n              connectedUser2: notif.from,\n            });\n\n            listenToConnectionEvents(\n              localConnection,\n              username,\n              notif.from,\n              database,\n              this.remoteVideoRef2,\n              doCandidate\n            );\n          }\n\n          sendAnswer(\n            localConnection,\n            localStream,\n            notif,\n            doAnswer,\n            database,\n            username\n          );\n\n          this.setState({ called: \"CALLED\" });\n\n          break;\n        case \"answer\":\n          console.log(\"case answer\");\n\n          if (counter === 0) {\n            this.setState({\n              connectedUser: notif.from,\n            });\n          }\n\n          if (counter === 1) {\n            this.setState({\n              connectedUser2: notif.from,\n            });\n          }\n\n          startCall(localConnection, notif);\n          break;\n        case \"candidate\":\n          console.log(\"case candidate\");\n          addCandidate(localConnection, notif);\n          if (calling === true) {\n            this.setState({ calling: false });\n            if (counter === 0) {\n              removeNotifs(database, user, connectedUser);\n            }\n            if (counter === 1) {\n              removeNotifs(database, user, connectedUser2);\n            }\n            counter = counter + 1;\n            this.setState({ counter });\n          }\n          if (called === \"CALLED4\") {\n            this.setState({ called: \"\" });\n            counter = counter + 1;\n            this.setState({ counter });\n          }\n          if (called === \"CALLED3\") {\n            this.setState({ called: \"CALLED4\" });\n          }\n          if (called === \"CALLED2\") {\n            this.setState({ called: \"CALLED3\" });\n          }\n          if (called === \"CALLED\") {\n            this.setState({ called: \"CALLED2\" });\n          }\n          break;\n        default:\n          break;\n      }\n    }\n  };\n\n  render() {\n    return (\n      <VideoChat\n        startCall={this.startCall}\n        onLogin={this.onLogin}\n        setLocalVideoRef={this.setLocalVideoRef}\n        setRemoteVideoRef={this.setRemoteVideoRef}\n        setRemoteVideoRef2={this.setRemoteVideoRef2}\n        connectedUser={this.state.connectedUser}\n        connectedUser2={this.state.connectedUser2}\n        username={this.state.username}\n        team={this.state.team}\n      />\n    );\n  }\n}\n\nexport default VideoChatContainer;\n"]},"metadata":{},"sourceType":"module"}