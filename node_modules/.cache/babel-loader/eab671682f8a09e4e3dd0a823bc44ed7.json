{"ast":null,"code":"var _jsxFileName = \"/Users/rushipat/Documents/Data/Programs/videochatapp/src/App.js\";\nimport React, { Component } from \"react\";\nimport \"./App.css\";\nimport VideoChatContainer from \"./VideoChatContainer\";\nimport firebase from \"firebase/app\";\nimport config from \"./config\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = async () => {\n      //component mounts, only after the first render on the client side\n      console.log(\"COMPONENT DID MOUNT\");\n      firebase.initializeApp(config); //this.writeUserData();\n\n      await this.getUserData();\n    };\n\n    this.writeUserData = () => {\n      //save the state\n      console.log(\"SAVING DATA\");\n      firebase.database().ref(\"/rooms\").set(this.state.rooms);\n      firebase.database().ref(\"/roomusers\").set(this.state.room_users);\n    };\n\n    this.errData = err => {\n      console.log(\"GOT AN ERROR\");\n      console.log(err);\n    };\n\n    this.nameNewRoom = () => {\n      console.log(\"NAMING NEW ROOM\");\n      this.setState({\n        active: 0\n      });\n    };\n\n    this.enterRoom = room => {\n      console.log(\"ENTERING ROOM\" + room.id);\n      const temp_roomusers = this.state.room_users;\n      temp_roomusers.push({\n        ip: this.state.user,\n        room: room.id\n      });\n      this.setState({\n        room_users: temp_roomusers\n      });\n      this.setState({\n        active: room.id + 1\n      });\n      this.findTeam(room.id);\n    };\n\n    this.authenticateUser = () => {\n      console.log(\"AUTHENTICATING USER\");\n      this.setState({\n        active: -1\n      });\n    };\n\n    this.constructRoom = () => {\n      console.log(\"CREATING ROOM\");\n      const temp_rooms = this.state.rooms;\n      temp_rooms.push({\n        id: temp_rooms.length\n      });\n      this.setState({\n        rooms: temp_rooms\n      });\n      const temp_roomusers = this.state.room_users;\n      temp_roomusers.push({\n        ip: this.state.user,\n        room: temp_rooms.length - 1\n      });\n      this.setState({\n        room_users: temp_roomusers\n      });\n      this.setState({\n        active: temp_rooms.length\n      });\n      this.findTeam(temp_rooms.length - 1);\n    };\n\n    this.findTeam = id => {\n      console.log(id);\n      const room_users = this.state.room_users;\n      const team = [];\n\n      for (let roomuser of room_users) {\n        if (roomuser.room === id + 1 && roomuser.ip !== this.state.user) {\n          console.log(roomuser.ip);\n          team.push(roomuser.ip);\n        }\n      }\n\n      this.setState({\n        team\n      });\n    };\n\n    this.leaveRoom = () => {\n      console.log(\"LEAVING ROOM\");\n      const room_users = this.state.room_users;\n      var filteredru = room_users.filter(function (value, index, arr) {\n        if (value.ip === this.state.user) {\n          return value;\n        }\n      });\n      this.setState({\n        room_users: filteredru\n      });\n      this.setState({\n        team: []\n      });\n      this.setState({\n        active: -1\n      });\n    };\n\n    this.state = {\n      retreivedData: false,\n      //probing end of componentDidMount\n      user: \"\",\n      //ip address\n      active: -2,\n      //-2 for no activity; -1 is not in a room, 0 is new room, otherwise room number + 1\n      busy: false,\n      //boolean for whether in Teams meeting or not\n      roomname: \"\",\n      team: [],\n      rooms: [],\n      //list of rooms and their IDs, which is their index within the array\n      room_users: [] //entry of ip address and room IDs +1\n\n    };\n    fetch(\"https://api.ipify.org?format=jsonp?callback=?\", {\n      method: \"GET\",\n      headers: {}\n    }).then(res => {\n      return res.text();\n    }).then(ip => {\n      const rand = Math.floor(Math.random() * 1000);\n      this.setState({\n        user: ip + rand\n      });\n      console.log(this.state.user);\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    //before completion of componentDidMount\n    if (this.state.retreivedData === false) {\n      return;\n    } //after completion of componentDidMount\n\n\n    if (this.state.retreivedData === true) {\n      console.log(\"COMPONENT DID UPDATE\");\n\n      if (prevState !== this.state) {\n        this.writeUserData();\n      }\n    }\n  }\n\n  async getUserData() {\n    //retrieve data from firebase\n    console.log(\"RETREIVING DATA\");\n    await firebase.database().ref(\"rooms\").once(\"value\").then(snapshot => {\n      this.gotRooms(snapshot);\n    });\n    await firebase.database().ref(\"roomusers\").once(\"value\").then(snapshot => {\n      this.gotRoomUsers(snapshot);\n    });\n    this.setState({\n      retreivedData: true\n    });\n  }\n\n  gotRooms(data) {\n    console.log(\"GOT ROOMS\");\n    const temp_rooms = data.val();\n    const parsed_rooms = Object.keys(temp_rooms).map(room => {\n      return {\n        id: temp_rooms[room].id\n      };\n    });\n    this.setState({\n      rooms: parsed_rooms\n    });\n  }\n\n  gotRoomUsers(data) {\n    console.log(\"GOT ROOMUSERS\");\n    const temp_roomusers = data.val();\n    const parsed_roomusers = Object.keys(temp_roomusers).map(roomuser => {\n      return {\n        ip: temp_roomusers[roomuser].ip,\n        room: temp_roomusers[roomuser].room\n      };\n    });\n    this.setState({\n      room_users: parsed_roomusers\n    });\n  }\n\n  render() {\n    const rooms = this.state.rooms;\n    const room_users = this.state.room_users;\n    const active = this.state.active;\n\n    if (active === -2) {\n      return React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"container-fluid\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"row align-items-center bg-primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-xl-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        className: \"display-1 text-center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, \"myWorkplace\")), React.createElement(\"div\", {\n        className: \"col-xl-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        className: \"text-center text-light\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, \"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations.\"))), React.createElement(\"div\", {\n        className: \"row mt-5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row d-flex justify-content-around\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: () => this.authenticateUser(),\n        className: \"btn btn-primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, \"Click to enter myWorkplace\"))));\n    }\n\n    if (active === -1) {\n      return React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"container-fluid\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"row align-items-center bg-primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-xl-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        className: \"display-1 text-center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }, \"myWorkplace\")), React.createElement(\"div\", {\n        className: \"col-xl-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        className: \"text-center text-light\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, \"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations.\"))), React.createElement(\"div\", {\n        className: \"row mt-5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row d-flex justify-content-around\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, rooms.map(room => React.createElement(\"div\", {\n        className: \"col-sm-4 d-flex justify-content-around\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        key: room.id + 1,\n        style: {\n          width: \"18rem\",\n          marginRight: \"1rem\",\n          textAlign: \"center\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"card-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262\n        },\n        __self: this\n      }, React.createElement(\"h5\", {\n        className: \"card-title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      }, room.id + 1), React.createElement(\"p\", {\n        className: \"card-text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      }, \"List users here\"), React.createElement(\"button\", {\n        onClick: () => this.enterRoom(room),\n        className: \"btn btn-link\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265\n        },\n        __self: this\n      }, \"Enter room\")))))), React.createElement(\"div\", {\n        className: \"row mt-5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row d-flex justify-content-around\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 279\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: () => this.constructRoom(),\n        className: \"btn btn-primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280\n        },\n        __self: this\n      }, \"Create New Room\"))));\n    }\n\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row align-items-center bg-primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-xl-12\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      className: \"display-1 text-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297\n      },\n      __self: this\n    }, \"myWorkplace\")), React.createElement(\"div\", {\n      className: \"col-xl-12\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: \"text-center text-light\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, \"myWorkplace is a prototype application intended to facilitate more spontanenous virtual conversations.\"))), React.createElement(\"div\", {\n      className: \"row mt-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"row d-flex justify-content-around\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309\n      },\n      __self: this\n    }, \"In room \", active), React.createElement(\"div\", {\n      className: \"row mt-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313\n      },\n      __self: this\n    }), React.createElement(VideoChatContainer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"row mt-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"row d-flex justify-content-around\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: () => this.leaveRoom(),\n      className: \"btn btn-primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320\n      },\n      __self: this\n    }, \"Leave room \", active)))); //return (\n    //  <div className=\"app\">\n    //    <h1>React Video Chat App</h1>\n    //    <h2>WebRTC + Firebase</h2>\n    //    <VideoChatContainer />\n    //  </div>\n    //);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/rushipat/Documents/Data/Programs/videochatapp/src/App.js"],"names":["React","Component","VideoChatContainer","firebase","config","App","constructor","props","componentDidMount","console","log","initializeApp","getUserData","writeUserData","database","ref","set","state","rooms","room_users","errData","err","nameNewRoom","setState","active","enterRoom","room","id","temp_roomusers","push","ip","user","findTeam","authenticateUser","constructRoom","temp_rooms","length","team","roomuser","leaveRoom","filteredru","filter","value","index","arr","retreivedData","busy","roomname","fetch","method","headers","then","res","text","rand","Math","floor","random","componentDidUpdate","prevProps","prevState","once","snapshot","gotRooms","gotRoomUsers","data","val","parsed_rooms","Object","keys","map","parsed_roomusers","render","width","marginRight","textAlign"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./App.css\";\nimport VideoChatContainer from \"./VideoChatContainer\";\nimport firebase from \"firebase/app\";\nimport config from \"./config\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      retreivedData: false, //probing end of componentDidMount\n      user: \"\", //ip address\n      active: -2, //-2 for no activity; -1 is not in a room, 0 is new room, otherwise room number + 1\n      busy: false, //boolean for whether in Teams meeting or not\n      roomname: \"\",\n      team: [],\n\n      rooms: [], //list of rooms and their IDs, which is their index within the array\n      room_users: [], //entry of ip address and room IDs +1\n    };\n\n    fetch(\"https://api.ipify.org?format=jsonp?callback=?\", {\n      method: \"GET\",\n      headers: {},\n    })\n      .then((res) => {\n        return res.text();\n      })\n      .then((ip) => {\n        const rand = Math.floor(Math.random() * 1000);\n        this.setState({ user: ip + rand });\n        console.log(this.state.user);\n      });\n  }\n\n  componentDidMount = async () => {\n    //component mounts, only after the first render on the client side\n    console.log(\"COMPONENT DID MOUNT\");\n\n    firebase.initializeApp(config);\n\n    //this.writeUserData();\n\n    await this.getUserData();\n  };\n\n  componentDidUpdate(prevProps, prevState) {\n    //before completion of componentDidMount\n    if (this.state.retreivedData === false) {\n      return;\n    }\n\n    //after completion of componentDidMount\n    if (this.state.retreivedData === true) {\n      console.log(\"COMPONENT DID UPDATE\");\n      if (prevState !== this.state) {\n        this.writeUserData();\n      }\n    }\n  }\n\n  writeUserData = () => {\n    //save the state\n    console.log(\"SAVING DATA\");\n\n    firebase.database().ref(\"/rooms\").set(this.state.rooms);\n    firebase.database().ref(\"/roomusers\").set(this.state.room_users);\n  };\n\n  async getUserData() {\n    //retrieve data from firebase\n    console.log(\"RETREIVING DATA\");\n\n    await firebase\n      .database()\n      .ref(\"rooms\")\n      .once(\"value\")\n      .then((snapshot) => {\n        this.gotRooms(snapshot);\n      });\n\n    await firebase\n      .database()\n      .ref(\"roomusers\")\n      .once(\"value\")\n      .then((snapshot) => {\n        this.gotRoomUsers(snapshot);\n      });\n\n    this.setState({ retreivedData: true });\n  }\n\n  gotRooms(data) {\n    console.log(\"GOT ROOMS\");\n\n    const temp_rooms = data.val();\n    const parsed_rooms = Object.keys(temp_rooms).map((room) => {\n      return { id: temp_rooms[room].id };\n    });\n\n    this.setState({ rooms: parsed_rooms });\n  }\n\n  gotRoomUsers(data) {\n    console.log(\"GOT ROOMUSERS\");\n\n    const temp_roomusers = data.val();\n    const parsed_roomusers = Object.keys(temp_roomusers).map((roomuser) => {\n      return {\n        ip: temp_roomusers[roomuser].ip,\n        room: temp_roomusers[roomuser].room,\n      };\n    });\n\n    this.setState({ room_users: parsed_roomusers });\n  }\n\n  errData = (err) => {\n    console.log(\"GOT AN ERROR\");\n\n    console.log(err);\n  };\n\n  nameNewRoom = () => {\n    console.log(\"NAMING NEW ROOM\");\n    this.setState({ active: 0 });\n  };\n\n  enterRoom = (room) => {\n    console.log(\"ENTERING ROOM\" + room.id);\n\n    const temp_roomusers = this.state.room_users;\n\n    temp_roomusers.push({ ip: this.state.user, room: room.id });\n\n    this.setState({ room_users: temp_roomusers });\n\n    this.setState({ active: room.id + 1 });\n    this.findTeam(room.id);\n  };\n\n  authenticateUser = () => {\n    console.log(\"AUTHENTICATING USER\");\n    this.setState({ active: -1 });\n  };\n\n  constructRoom = () => {\n    console.log(\"CREATING ROOM\");\n\n    const temp_rooms = this.state.rooms;\n\n    temp_rooms.push({ id: temp_rooms.length });\n    this.setState({ rooms: temp_rooms });\n\n    const temp_roomusers = this.state.room_users;\n\n    temp_roomusers.push({ ip: this.state.user, room: temp_rooms.length - 1 });\n\n    this.setState({ room_users: temp_roomusers });\n\n    this.setState({ active: temp_rooms.length });\n    this.findTeam(temp_rooms.length - 1);\n  };\n\n  findTeam = (id) => {\n    console.log(id);\n    const room_users = this.state.room_users;\n    const team = [];\n\n    for (let roomuser of room_users) {\n      if (roomuser.room === id + 1 && roomuser.ip !== this.state.user) {\n        console.log(roomuser.ip);\n        team.push(roomuser.ip);\n      }\n    }\n\n    this.setState({ team });\n  };\n\n  leaveRoom = () => {\n    console.log(\"LEAVING ROOM\");\n\n    const room_users = this.state.room_users;\n\n    var filteredru = room_users.filter(function (value, index, arr) {\n      if (value.ip === this.state.user) {\n        return value;\n      }\n    });\n\n    this.setState({ room_users: filteredru });\n    this.setState({ team: [] });\n    this.setState({ active: -1 });\n  };\n\n  render() {\n    const { rooms } = this.state;\n    const { room_users } = this.state;\n    const { active } = this.state;\n\n    if (active === -2) {\n      return (\n        <React.Fragment>\n          <div className=\"container-fluid\">\n            <div className=\"row align-items-center bg-primary\">\n              <div className=\"col-xl-12\">\n                <h1 className=\"display-1 text-center\">myWorkplace</h1>\n              </div>\n              <div className=\"col-xl-12\">\n                <p className=\"text-center text-light\">\n                  myWorkplace is a prototype application intended to facilitate\n                  more spontanenous virtual conversations.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"row mt-5\"></div>\n\n            <div className=\"row d-flex justify-content-around\">\n              <button\n                onClick={() => this.authenticateUser()}\n                className=\"btn btn-primary\"\n              >\n                Click to enter myWorkplace\n              </button>\n            </div>\n          </div>\n        </React.Fragment>\n      );\n    }\n\n    if (active === -1) {\n      return (\n        <React.Fragment>\n          <div className=\"container-fluid\">\n            <div className=\"row align-items-center bg-primary\">\n              <div className=\"col-xl-12\">\n                <h1 className=\"display-1 text-center\">myWorkplace</h1>\n              </div>\n              <div className=\"col-xl-12\">\n                <p className=\"text-center text-light\">\n                  myWorkplace is a prototype application intended to facilitate\n                  more spontanenous virtual conversations.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"row mt-5\"></div>\n\n            <div className=\"row d-flex justify-content-around\">\n              {rooms.map((room) => (\n                <div className=\"col-sm-4 d-flex justify-content-around\">\n                  <div\n                    key={room.id + 1}\n                    style={{\n                      width: \"18rem\",\n                      marginRight: \"1rem\",\n                      textAlign: \"center\",\n                    }}\n                  >\n                    <div className=\"card-body\">\n                      <h5 className=\"card-title\">{room.id + 1}</h5>\n                      <p className=\"card-text\">List users here</p>\n                      <button\n                        onClick={() => this.enterRoom(room)}\n                        className=\"btn btn-link\"\n                      >\n                        Enter room\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"row mt-5\"></div>\n\n            <div className=\"row d-flex justify-content-around\">\n              <button\n                onClick={() => this.constructRoom()}\n                className=\"btn btn-primary\"\n              >\n                Create New Room\n              </button>\n            </div>\n          </div>\n        </React.Fragment>\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <div className=\"container-fluid\">\n          <div className=\"row align-items-center bg-primary\">\n            <div className=\"col-xl-12\">\n              <h1 className=\"display-1 text-center\">myWorkplace</h1>\n            </div>\n            <div className=\"col-xl-12\">\n              <p className=\"text-center text-light\">\n                myWorkplace is a prototype application intended to facilitate\n                more spontanenous virtual conversations.\n              </p>\n            </div>\n          </div>\n\n          <div className=\"row mt-5\"></div>\n\n          <div className=\"row d-flex justify-content-around\">\n            In room {active}\n          </div>\n\n          <div className=\"row mt-5\"></div>\n\n          <VideoChatContainer />\n\n          <div className=\"row mt-5\"></div>\n\n          <div className=\"row d-flex justify-content-around\">\n            <button\n              onClick={() => this.leaveRoom()}\n              className=\"btn btn-primary\"\n            >\n              Leave room {active}\n            </button>\n          </div>\n        </div>\n      </React.Fragment>\n    );\n\n    //return (\n    //  <div className=\"app\">\n    //    <h1>React Video Chat App</h1>\n    //    <h2>WebRTC + Firebase</h2>\n    //    <VideoChatContainer />\n    //  </div>\n    //);\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}