{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rushipat/Documents/Data/Programs/videochatapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";export var createOffer=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(connection,localStream,userToCall,doOffer,database,username){var offer;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"In createoffer\");_context.prev=1;console.log(connection);console.log(localStream);connection.addStream(localStream);console.log(\"1\");_context.next=8;return connection.createOffer();case 8:offer=_context.sent;console.log(\"2\");_context.next=12;return connection.setLocalDescription(offer);case 12:console.log(\"3\");doOffer(userToCall,offer,database,username);_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 19:case\"end\":return _context.stop();}}},_callee,null,[[1,16]]);}));return function createOffer(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments);};}();export var initiateLocalStream=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var stream;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(\"In initiatelocalstream\");_context2.prev=1;_context2.next=4;return navigator.mediaDevices.getUserMedia({video:true,audio:true});case 4:stream=_context2.sent;return _context2.abrupt(\"return\",stream);case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.error(_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function initiateLocalStream(){return _ref2.apply(this,arguments);};}();export var initiateConnection=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var configuration1,configuration2,configuration3,configuration4,conn1,conn2,conn3,conn4,conn;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"In initiateconnection\");_context3.prev=1;// using Google public stun server\nconfiguration1={iceServers:[{urls:\"stun:stun1.1.google.com:19302\"}]};configuration2={iceServers:[{urls:\"stun:stun2.1.google.com:19302\"}]};configuration3={iceServers:[{urls:\"stun:stun3.1.google.com:19302\"}]};configuration4={iceServers:[{urls:\"stun:stun4.1.google.com:19302\"}]};conn1=new RTCPeerConnection(configuration1);conn2=new RTCPeerConnection(configuration2);conn3=new RTCPeerConnection(configuration3);conn4=new RTCPeerConnection(configuration4);//const conn = [conn1, conn2, conn3, conn4];\nconsole.log(conn1);console.log(conn2);conn=[conn1,conn2,conn3,conn4];console.log(conn[0]);return _context3.abrupt(\"return\",conn);case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](1);console.error(_context3.t0);case 20:case\"end\":return _context3.stop();}}},_callee3,null,[[1,17]]);}));return function initiateConnection(){return _ref3.apply(this,arguments);};}();export var listenToConnectionEvents=function listenToConnectionEvents(conn,username,remoteUsername,database,remoteVideoRef,doCandidate){console.log(\"In listentoconnectionevents\");conn.onicecandidate=function(event){if(event.candidate){doCandidate(remoteUsername,event.candidate,database,username);}};// when a remote user adds stream to the peer connection, we display it\nconn.ontrack=function(e){if(remoteVideoRef.srcObject!==e.streams[0]){remoteVideoRef.srcObject=e.streams[0];}};};export var sendAnswer=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(conn,localStream,notif,doAnswer,database,username){var offer,answer;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"In sendanswer\");_context4.prev=1;conn.addStream(localStream);console.log(\"1\");offer=JSON.parse(notif.offer);console.log(\"2\");conn.setRemoteDescription(offer);console.log(\"3\");// create an answer to an offer\n_context4.next=10;return conn.createAnswer();case 10:answer=_context4.sent;console.log(\"4\");conn.setLocalDescription(answer);console.log(\"5\");doAnswer(notif.from,answer,database,username);_context4.next=20;break;case 17:_context4.prev=17;_context4.t0=_context4[\"catch\"](1);console.error(_context4.t0);case 20:case\"end\":return _context4.stop();}}},_callee4,null,[[1,17]]);}));return function sendAnswer(_x7,_x8,_x9,_x10,_x11,_x12){return _ref4.apply(this,arguments);};}();export var startCall=function startCall(yourConn,notif){console.log(\"In startcall\");var answer=JSON.parse(notif.answer);yourConn.setRemoteDescription(answer);};export var addCandidate=function addCandidate(yourConn,notif){console.log(\"In addcandidate\");// apply the new received candidate to the connection\nvar candidate=JSON.parse(notif.candidate);yourConn.addIceCandidate(new RTCIceCandidate(candidate));};","map":{"version":3,"sources":["/Users/rushipat/Documents/Data/Programs/videochatapp/src/modules/RTCModule.js"],"names":["createOffer","connection","localStream","userToCall","doOffer","database","username","console","log","addStream","offer","setLocalDescription","error","initiateLocalStream","navigator","mediaDevices","getUserMedia","video","audio","stream","initiateConnection","configuration1","iceServers","urls","configuration2","configuration3","configuration4","conn1","RTCPeerConnection","conn2","conn3","conn4","conn","listenToConnectionEvents","remoteUsername","remoteVideoRef","doCandidate","onicecandidate","event","candidate","ontrack","e","srcObject","streams","sendAnswer","notif","doAnswer","JSON","parse","setRemoteDescription","createAnswer","answer","from","startCall","yourConn","addCandidate","addIceCandidate","RTCIceCandidate"],"mappings":"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","sourcesContent":["export const createOffer = async (\n  connection,\n  localStream,\n  userToCall,\n  doOffer,\n  database,\n  username\n) => {\n  console.log(\"In createoffer\");\n  try {\n    console.log(connection);\n    console.log(localStream);\n    connection.addStream(localStream);\n    console.log(\"1\");\n    const offer = await connection.createOffer();\n    console.log(\"2\");\n    await connection.setLocalDescription(offer);\n    console.log(\"3\");\n    doOffer(userToCall, offer, database, username);\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const initiateLocalStream = async () => {\n  console.log(\"In initiatelocalstream\");\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true,\n    });\n    return stream;\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const initiateConnection = async () => {\n  console.log(\"In initiateconnection\");\n  try {\n    // using Google public stun server\n    var configuration1 = {\n      iceServers: [{ urls: \"stun:stun1.1.google.com:19302\" }],\n    };\n    var configuration2 = {\n      iceServers: [{ urls: \"stun:stun2.1.google.com:19302\" }],\n    };\n    var configuration3 = {\n      iceServers: [{ urls: \"stun:stun3.1.google.com:19302\" }],\n    };\n    var configuration4 = {\n      iceServers: [{ urls: \"stun:stun4.1.google.com:19302\" }],\n    };\n\n    const conn1 = new RTCPeerConnection(configuration1);\n    const conn2 = new RTCPeerConnection(configuration2);\n    const conn3 = new RTCPeerConnection(configuration3);\n    const conn4 = new RTCPeerConnection(configuration4);\n\n    //const conn = [conn1, conn2, conn3, conn4];\n\n    console.log(conn1);\n    console.log(conn2);\n\n    const conn = [conn1, conn2, conn3, conn4];\n\n    console.log(conn[0]);\n\n    return conn;\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const listenToConnectionEvents = (\n  conn,\n  username,\n  remoteUsername,\n  database,\n  remoteVideoRef,\n  doCandidate\n) => {\n  console.log(\"In listentoconnectionevents\");\n  conn.onicecandidate = function (event) {\n    if (event.candidate) {\n      doCandidate(remoteUsername, event.candidate, database, username);\n    }\n  };\n\n  // when a remote user adds stream to the peer connection, we display it\n  conn.ontrack = function (e) {\n    if (remoteVideoRef.srcObject !== e.streams[0]) {\n      remoteVideoRef.srcObject = e.streams[0];\n    }\n  };\n};\n\nexport const sendAnswer = async (\n  conn,\n  localStream,\n  notif,\n  doAnswer,\n  database,\n  username\n) => {\n  console.log(\"In sendanswer\");\n  try {\n    conn.addStream(localStream);\n    console.log(\"1\");\n\n    const offer = JSON.parse(notif.offer);\n    console.log(\"2\");\n    conn.setRemoteDescription(offer);\n    console.log(\"3\");\n\n    // create an answer to an offer\n    const answer = await conn.createAnswer();\n    console.log(\"4\");\n    conn.setLocalDescription(answer);\n    console.log(\"5\");\n\n    doAnswer(notif.from, answer, database, username);\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const startCall = (yourConn, notif) => {\n  console.log(\"In startcall\");\n  const answer = JSON.parse(notif.answer);\n  yourConn.setRemoteDescription(answer);\n};\n\nexport const addCandidate = (yourConn, notif) => {\n  console.log(\"In addcandidate\");\n  // apply the new received candidate to the connection\n  const candidate = JSON.parse(notif.candidate);\n  yourConn.addIceCandidate(new RTCIceCandidate(candidate));\n};\n"]},"metadata":{},"sourceType":"module"}