{"ast":null,"code":"var _jsxFileName = \"/Users/rushipat/Documents/Data/Programs/videochatapp/src/VideoChatContainer.js\";\nimport React from \"react\";\nimport \"./App.css\";\nimport { createOffer, initiateConnection, startCall, sendAnswer, addCandidate, initiateLocalStream, listenToConnectionEvents } from \"./modules/RTCModule\";\nimport firebase from \"firebase/app\";\nimport \"firebase/database\";\nimport config from \"./config\";\nimport { doOffer, doAnswer, doLogin, doCandidate, removeNotifs } from \"./modules/FirebaseModule\";\nimport \"webrtc-adapter\";\nimport VideoChat from \"./VideoChat\";\n\nclass VideoChatContainer extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = async () => {\n      // getting local video stream\n      console.log(\"In component did mount\");\n      console.log(this.state.username);\n      const localStream1 = await initiateLocalStream();\n      const localStream2 = await initiateLocalStream();\n      const localStream3 = await initiateLocalStream();\n      const localStream4 = await initiateLocalStream();\n      const localStreamSet = [localStream1, localStream2, localStream3, localStream4];\n      const localConnectionSet = await initiateConnection();\n      console.log(localConnectionSet[0]);\n      const localConnection = localConnectionSet[this.state.counter];\n      const localStream = localStreamSet[this.state.counter];\n      this.localVideoRef.srcObject = localStreamSet[0]; //this.localVideoRef2.srcObject = localStreamSet[1];\n      //this.localVideoRef3.srcObject = localStreamSet[2];\n      //this.localVideoRef4.srcObject = localStreamSet[3];\n\n      this.setState({\n        database: firebase.database(),\n        localStream,\n        localStreamSet,\n        localConnectionSet,\n        localConnection\n      });\n      await this.onLogin(this.state.username);\n      const team = this.state.team;\n\n      if (team.length !== 0) {\n        this.startCall(this.state.username, team[0]);\n      }\n    };\n\n    this.startCall = async (username, userToCall) => {\n      console.log(\"In starting call\");\n      this.setState({\n        calling: true\n      });\n      console.log(\"checking state 2\");\n      console.log(this.state.localConnection);\n      console.log(this.state.localStream);\n      const database = this.state.database;\n      var localConnection = this.state.localConnection;\n      var localStream = this.state.localStream;\n      var counter = this.state;\n      var vid = null;\n\n      if (counter === 0) {\n        vid = this.remoteVideoRef;\n      }\n\n      if (counter === 1) {\n        vid = this.remoteVideoRef2;\n      }\n\n      if (counter === 2) {\n        vid = this.remoteVideoRef3;\n      }\n\n      console.log(localConnection);\n      listenToConnectionEvents(localConnection, username, userToCall, database, vid, doCandidate); // create an offer\n\n      createOffer(localConnection, localStream, userToCall, doOffer, database, username);\n    };\n\n    this.onLogin = async username => {\n      console.log(\"In onlogin\");\n      return await doLogin(username, this.state.database, this.handleUpdate);\n    };\n\n    this.setLocalVideoRef = ref => {\n      console.log(\"In setlocalvideoref\");\n      this.localVideoRef = ref;\n    };\n\n    this.setRemoteVideoRef1 = ref => {\n      console.log(\"In setremotevideoref1\");\n      this.remoteVideoRef = ref;\n    };\n\n    this.setRemoteVideoRef2 = ref => {\n      console.log(\"In setremotevideoref2\");\n      this.remoteVideoRef2 = ref;\n    };\n\n    this.handleUpdate = (notif, username) => {\n      console.log(\"In handleupdate\");\n      const _this$state = this.state,\n            localConnection = _this$state.localConnection,\n            database = _this$state.database,\n            localStream = _this$state.localStream;\n      var counter = this.state.counter;\n      var calling = this.state.calling;\n      const user = this.state.username;\n      const called = this.state.called;\n      const connectedUser = this.state.connectedUser;\n      console.log(connectedUser);\n      var vid = null;\n\n      if (counter === 0) {\n        vid = this.remoteVideoRef;\n      }\n\n      if (counter === 1) {\n        vid = this.remoteVideoRef2;\n      }\n\n      if (counter === 2) {\n        vid = this.remoteVideoRef3;\n      }\n\n      if (notif) {\n        switch (notif.type) {\n          case \"offer\":\n            console.log(\"case offer\");\n            this.setState({\n              connectedUser: notif.from\n            });\n            listenToConnectionEvents(localConnection, username, notif.from, database, vid, doCandidate);\n            sendAnswer(localConnection, localStream, notif, doAnswer, database, username);\n            this.setState({\n              called: \"CALLED\"\n            });\n            break;\n\n          case \"answer\":\n            console.log(\"case answer\");\n            this.setState({\n              connectedUser: notif.from\n            });\n            startCall(localConnection, notif);\n            break;\n\n          case \"candidate\":\n            console.log(\"case candidate\");\n            addCandidate(localConnection, notif);\n\n            if (calling === true) {\n              this.setState({\n                calling: false\n              });\n              removeNotifs(database, user, connectedUser);\n              counter = counter + 1;\n              this.setState({\n                counter\n              });\n            }\n\n            if (called === \"CALLED4\") {\n              this.setState({\n                called: \"\"\n              });\n              counter = counter + 1;\n              this.setState({\n                counter\n              });\n            }\n\n            if (called === \"CALLED3\") {\n              this.setState({\n                called: \"CALLED4\"\n              });\n            }\n\n            if (called === \"CALLED2\") {\n              this.setState({\n                called: \"CALLED3\"\n              });\n            }\n\n            if (called === \"CALLED\") {\n              this.setState({\n                called: \"CALLED2\"\n              });\n            }\n\n            break;\n\n          default:\n            break;\n        }\n      }\n    };\n\n    this.state = {\n      database: null,\n      connectedUser1: null,\n      connectedUser2: null,\n      localStream: null,\n      localStreamSet: null,\n      localConnectionSet: null,\n      localConnection: null,\n      username: this.props.username,\n      team: this.props.team,\n      counter: 0,\n      calling: false\n    };\n    this.localVideoRef = React.createRef(); //this.localVideoRef2 = React.createRef();\n    //this.localVideoRef3 = React.createRef();\n    //this.localVideoRef4 = React.createRef();\n\n    this.remoteVideoRef = React.createRef();\n    this.remoteVideoRef2 = React.createRef();\n    this.remoteVideoRef3 = React.createRef();\n    this.remoteVideoRef4 = React.createRef();\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    if (this.state.database !== nextState.database) {\n      return false;\n    }\n\n    if (this.state.localStream !== nextState.localStream) {\n      return false;\n    }\n\n    if (this.state.localConnection !== nextState.localConnection) {\n      return false;\n    }\n\n    return true;\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log(\"In component did update\");\n    const counter = this.state.counter;\n    console.log(counter);\n    const team = this.state.team;\n    const localConnectionSet = this.state.localConnectionSet;\n    const localStreamSet = this.state.localStreamSet;\n\n    if (prevState.counter !== counter) {\n      console.log(\"changing connection and stream\");\n      console.log(\"previous connection\");\n      console.log(this.state.localConnection);\n      console.log(this.state.localStream);\n      var localConn = localConnectionSet[counter];\n      var localStr = localStreamSet[counter];\n      console.log(\"new connection\");\n      console.log(localConn);\n      console.log(localStr);\n      this.setState({\n        localConnection: localConn\n      });\n      this.setState({\n        localStream: localStr\n      });\n      console.log(\"checking state 1\");\n      console.log(this.state.localConnection);\n      console.log(this.state.localStream);\n    }\n\n    if (prevState.counter !== counter && counter < team.length) {\n      console.log(\"will be connecting to new user\");\n      this.setState({\n        calling: true\n      }, function () {\n        console.log(\"async setstate\");\n        this.startCall(this.state.username, team[counter]);\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(VideoChat, {\n      startCall: this.startCall,\n      onLogin: this.onLogin,\n      setLocalVideoRef: this.setLocalVideoRef,\n      setRemoteVideoRef1: this.setRemoteVideoRef1,\n      setRemoteVideoRef2: this.setRemoteVideoRef2,\n      connectedUser1: this.state.connectedUser1,\n      connectedUser2: this.state.connectedUser2,\n      username: this.state.username,\n      team: this.state.team,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302\n      },\n      __self: this\n    });\n  }\n\n}\n\nexport default VideoChatContainer;","map":{"version":3,"sources":["/Users/rushipat/Documents/Data/Programs/videochatapp/src/VideoChatContainer.js"],"names":["React","createOffer","initiateConnection","startCall","sendAnswer","addCandidate","initiateLocalStream","listenToConnectionEvents","firebase","config","doOffer","doAnswer","doLogin","doCandidate","removeNotifs","VideoChat","VideoChatContainer","Component","constructor","props","componentDidMount","console","log","state","username","localStream1","localStream2","localStream3","localStream4","localStreamSet","localConnectionSet","localConnection","counter","localStream","localVideoRef","srcObject","setState","database","onLogin","team","length","userToCall","calling","vid","remoteVideoRef","remoteVideoRef2","remoteVideoRef3","handleUpdate","setLocalVideoRef","ref","setRemoteVideoRef1","setRemoteVideoRef2","notif","user","called","connectedUser","type","from","connectedUser1","connectedUser2","createRef","remoteVideoRef4","shouldComponentUpdate","nextProps","nextState","componentDidUpdate","prevProps","prevState","localConn","localStr","render"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport \"./App.css\";\nimport {\n  createOffer,\n  initiateConnection,\n  startCall,\n  sendAnswer,\n  addCandidate,\n  initiateLocalStream,\n  listenToConnectionEvents,\n} from \"./modules/RTCModule\";\nimport firebase from \"firebase/app\";\nimport \"firebase/database\";\nimport config from \"./config\";\nimport {\n  doOffer,\n  doAnswer,\n  doLogin,\n  doCandidate,\n  removeNotifs,\n} from \"./modules/FirebaseModule\";\nimport \"webrtc-adapter\";\nimport VideoChat from \"./VideoChat\";\n\nclass VideoChatContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      database: null,\n      connectedUser1: null,\n      connectedUser2: null,\n      localStream: null,\n      localStreamSet: null,\n      localConnectionSet: null,\n      localConnection: null,\n      username: this.props.username,\n      team: this.props.team,\n      counter: 0,\n      calling: false,\n    };\n    this.localVideoRef = React.createRef();\n    //this.localVideoRef2 = React.createRef();\n    //this.localVideoRef3 = React.createRef();\n    //this.localVideoRef4 = React.createRef();\n    this.remoteVideoRef = React.createRef();\n    this.remoteVideoRef2 = React.createRef();\n    this.remoteVideoRef3 = React.createRef();\n    this.remoteVideoRef4 = React.createRef();\n  }\n\n  componentDidMount = async () => {\n    // getting local video stream\n    console.log(\"In component did mount\");\n\n    console.log(this.state.username);\n\n    const localStream1 = await initiateLocalStream();\n    const localStream2 = await initiateLocalStream();\n    const localStream3 = await initiateLocalStream();\n    const localStream4 = await initiateLocalStream();\n\n    const localStreamSet = [\n      localStream1,\n      localStream2,\n      localStream3,\n      localStream4,\n    ];\n\n    const localConnectionSet = await initiateConnection();\n\n    console.log(localConnectionSet[0]);\n\n    const localConnection = localConnectionSet[this.state.counter];\n\n    const localStream = localStreamSet[this.state.counter];\n\n    this.localVideoRef.srcObject = localStreamSet[0];\n    //this.localVideoRef2.srcObject = localStreamSet[1];\n    //this.localVideoRef3.srcObject = localStreamSet[2];\n    //this.localVideoRef4.srcObject = localStreamSet[3];\n\n    this.setState({\n      database: firebase.database(),\n      localStream,\n      localStreamSet,\n      localConnectionSet,\n      localConnection,\n    });\n\n    await this.onLogin(this.state.username);\n\n    const team = this.state.team;\n\n    if (team.length !== 0) {\n      this.startCall(this.state.username, team[0]);\n    }\n  };\n\n  shouldComponentUpdate(nextProps, nextState) {\n    if (this.state.database !== nextState.database) {\n      return false;\n    }\n    if (this.state.localStream !== nextState.localStream) {\n      return false;\n    }\n    if (this.state.localConnection !== nextState.localConnection) {\n      return false;\n    }\n\n    return true;\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log(\"In component did update\");\n\n    const counter = this.state.counter;\n    console.log(counter);\n    const team = this.state.team;\n    const localConnectionSet = this.state.localConnectionSet;\n    const localStreamSet = this.state.localStreamSet;\n\n    if (prevState.counter !== counter) {\n      console.log(\"changing connection and stream\");\n      console.log(\"previous connection\");\n      console.log(this.state.localConnection);\n      console.log(this.state.localStream);\n      var localConn = localConnectionSet[counter];\n      var localStr = localStreamSet[counter];\n      console.log(\"new connection\");\n      console.log(localConn);\n      console.log(localStr);\n      this.setState({ localConnection: localConn });\n      this.setState({ localStream: localStr });\n      console.log(\"checking state 1\");\n      console.log(this.state.localConnection);\n      console.log(this.state.localStream);\n    }\n\n    if (prevState.counter !== counter && counter < team.length) {\n      console.log(\"will be connecting to new user\");\n      this.setState({ calling: true }, function () {\n        console.log(\"async setstate\");\n        this.startCall(this.state.username, team[counter]);\n      });\n    }\n  }\n\n  startCall = async (username, userToCall) => {\n    console.log(\"In starting call\");\n    this.setState({ calling: true });\n\n    console.log(\"checking state 2\");\n    console.log(this.state.localConnection);\n    console.log(this.state.localStream);\n\n    const { database } = this.state;\n    var localConnection = this.state.localConnection;\n    var localStream = this.state.localStream;\n    var counter = this.state;\n    var vid = null;\n\n    if (counter === 0) {\n      vid = this.remoteVideoRef;\n    }\n    if (counter === 1) {\n      vid = this.remoteVideoRef2;\n    }\n    if (counter === 2) {\n      vid = this.remoteVideoRef3;\n    }\n\n    console.log(localConnection);\n\n    listenToConnectionEvents(\n      localConnection,\n      username,\n      userToCall,\n      database,\n      vid,\n      doCandidate\n    );\n    // create an offer\n    createOffer(\n      localConnection,\n      localStream,\n      userToCall,\n      doOffer,\n      database,\n      username\n    );\n  };\n\n  onLogin = async (username) => {\n    console.log(\"In onlogin\");\n    return await doLogin(username, this.state.database, this.handleUpdate);\n  };\n\n  setLocalVideoRef = (ref) => {\n    console.log(\"In setlocalvideoref\");\n    this.localVideoRef = ref;\n  };\n\n  setRemoteVideoRef1 = (ref) => {\n    console.log(\"In setremotevideoref1\");\n    this.remoteVideoRef = ref;\n  };\n\n  setRemoteVideoRef2 = (ref) => {\n    console.log(\"In setremotevideoref2\");\n    this.remoteVideoRef2 = ref;\n  };\n\n  handleUpdate = (notif, username) => {\n    console.log(\"In handleupdate\");\n    const { localConnection, database, localStream } = this.state;\n    var counter = this.state.counter;\n    var calling = this.state.calling;\n    const user = this.state.username;\n    const called = this.state.called;\n    const connectedUser = this.state.connectedUser;\n    console.log(connectedUser);\n    var vid = null;\n\n    if (counter === 0) {\n      vid = this.remoteVideoRef;\n    }\n    if (counter === 1) {\n      vid = this.remoteVideoRef2;\n    }\n    if (counter === 2) {\n      vid = this.remoteVideoRef3;\n    }\n\n    if (notif) {\n      switch (notif.type) {\n        case \"offer\":\n          console.log(\"case offer\");\n          this.setState({\n            connectedUser: notif.from,\n          });\n\n          listenToConnectionEvents(\n            localConnection,\n            username,\n            notif.from,\n            database,\n            vid,\n            doCandidate\n          );\n\n          sendAnswer(\n            localConnection,\n            localStream,\n            notif,\n            doAnswer,\n            database,\n            username\n          );\n\n          this.setState({ called: \"CALLED\" });\n\n          break;\n        case \"answer\":\n          console.log(\"case answer\");\n          this.setState({\n            connectedUser: notif.from,\n          });\n          startCall(localConnection, notif);\n          break;\n        case \"candidate\":\n          console.log(\"case candidate\");\n          addCandidate(localConnection, notif);\n          if (calling === true) {\n            this.setState({ calling: false });\n            removeNotifs(database, user, connectedUser);\n            counter = counter + 1;\n            this.setState({ counter });\n          }\n          if (called === \"CALLED4\") {\n            this.setState({ called: \"\" });\n            counter = counter + 1;\n            this.setState({ counter });\n          }\n          if (called === \"CALLED3\") {\n            this.setState({ called: \"CALLED4\" });\n          }\n          if (called === \"CALLED2\") {\n            this.setState({ called: \"CALLED3\" });\n          }\n          if (called === \"CALLED\") {\n            this.setState({ called: \"CALLED2\" });\n          }\n          break;\n        default:\n          break;\n      }\n    }\n  };\n\n  render() {\n    return (\n      <VideoChat\n        startCall={this.startCall}\n        onLogin={this.onLogin}\n        setLocalVideoRef={this.setLocalVideoRef}\n        setRemoteVideoRef1={this.setRemoteVideoRef1}\n        setRemoteVideoRef2={this.setRemoteVideoRef2}\n        connectedUser1={this.state.connectedUser1}\n        connectedUser2={this.state.connectedUser2}\n        username={this.state.username}\n        team={this.state.team}\n      />\n    );\n  }\n}\n\nexport default VideoChatContainer;\n"]},"metadata":{},"sourceType":"module"}