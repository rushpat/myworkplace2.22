{"ast":null,"code":"export const createOffer = async (connection, localStream, userToCall, doOffer, database, username) => {\n  console.log(\"In createoffer\");\n\n  try {\n    connection.addStream(localStream);\n    console.log(\"1\");\n    const offer = await connection.createOffer();\n    console.log(\"2\");\n    await connection.setLocalDescription(offer);\n    console.log(\"3\");\n    doOffer(userToCall, offer, database, username);\n  } catch (exception) {\n    console.error(exception);\n  }\n};\nexport const initiateLocalStream = async () => {\n  console.log(\"In initiatelocalstream\");\n\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    });\n    return stream;\n  } catch (exception) {\n    console.error(exception);\n  }\n};\nexport const initiateConnection = async () => {\n  console.log(\"In initiateconnection\");\n\n  try {\n    // using Google public stun server\n    var configuration1 = {\n      iceServers: [{\n        urls: \"stun:stun1.1.google.com:19302\"\n      }]\n    };\n    var configuration2 = {\n      iceServers: [{\n        urls: \"stun:stun2.1.google.com:19302\"\n      }]\n    };\n    var configuration3 = {\n      iceServers: [{\n        urls: \"stun:stun3.1.google.com:19302\"\n      }]\n    };\n    var configuration4 = {\n      iceServers: [{\n        urls: \"stun:stun4.1.google.com:19302\"\n      }]\n    };\n    const conn1 = new RTCPeerConnection(configuration1);\n    const conn2 = new RTCPeerConnection(configuration2);\n    const conn3 = new RTCPeerConnection(configuration3);\n    const conn4 = new RTCPeerConnection(configuration4); //const conn = [conn1, conn2, conn3, conn4];\n\n    console.log(conn1);\n    console.log(conn2);\n    const conn = [conn1, conn2, conn3, conn4];\n    console.log(conn[0]);\n    return conn;\n  } catch (exception) {\n    console.error(exception);\n  }\n};\nexport const listenToConnectionEvents = (conn, username, remoteUsername, database, remoteVideoRef, doCandidate) => {\n  console.log(\"In listentoconnectionevents\");\n\n  conn.onicecandidate = function (event) {\n    if (event.candidate) {\n      doCandidate(remoteUsername, event.candidate, database, username);\n    }\n  }; // when a remote user adds stream to the peer connection, we display it\n\n\n  conn.ontrack = function (e) {\n    if (remoteVideoRef.srcObject !== e.streams[0]) {\n      remoteVideoRef.srcObject = e.streams[0];\n    }\n  };\n};\nexport const sendAnswer = async (conn, localStream, notif, doAnswer, database, username) => {\n  console.log(\"In sendanswer\");\n\n  try {\n    conn.addStream(localStream);\n    console.log(\"1\");\n    const offer = JSON.parse(notif.offer);\n    console.log(\"2\");\n    conn.setRemoteDescription(offer);\n    console.log(\"3\"); // create an answer to an offer\n\n    const answer = await conn.createAnswer();\n    console.log(\"4\");\n    conn.setLocalDescription(answer);\n    console.log(\"5\");\n    doAnswer(notif.from, answer, database, username);\n  } catch (exception) {\n    console.error(exception);\n  }\n};\nexport const startCall = (yourConn, notif) => {\n  console.log(\"In startcall\");\n  const answer = JSON.parse(notif.answer);\n  yourConn.setRemoteDescription(answer);\n};\nexport const addCandidate = (yourConn, notif) => {\n  console.log(\"In addcandidate\"); // apply the new received candidate to the connection\n\n  const candidate = JSON.parse(notif.candidate);\n  yourConn.addIceCandidate(new RTCIceCandidate(candidate));\n};","map":{"version":3,"sources":["/Users/rushipat/Documents/Data/Programs/videochatapp/src/modules/RTCModule.js"],"names":["createOffer","connection","localStream","userToCall","doOffer","database","username","console","log","addStream","offer","setLocalDescription","exception","error","initiateLocalStream","stream","navigator","mediaDevices","getUserMedia","video","audio","initiateConnection","configuration1","iceServers","urls","configuration2","configuration3","configuration4","conn1","RTCPeerConnection","conn2","conn3","conn4","conn","listenToConnectionEvents","remoteUsername","remoteVideoRef","doCandidate","onicecandidate","event","candidate","ontrack","e","srcObject","streams","sendAnswer","notif","doAnswer","JSON","parse","setRemoteDescription","answer","createAnswer","from","startCall","yourConn","addCandidate","addIceCandidate","RTCIceCandidate"],"mappings":"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","sourcesContent":["export const createOffer = async (\n  connection,\n  localStream,\n  userToCall,\n  doOffer,\n  database,\n  username\n) => {\n  console.log(\"In createoffer\");\n  try {\n    connection.addStream(localStream);\n    console.log(\"1\");\n    const offer = await connection.createOffer();\n    console.log(\"2\");\n    await connection.setLocalDescription(offer);\n    console.log(\"3\");\n    doOffer(userToCall, offer, database, username);\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const initiateLocalStream = async () => {\n  console.log(\"In initiatelocalstream\");\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true,\n    });\n    return stream;\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const initiateConnection = async () => {\n  console.log(\"In initiateconnection\");\n  try {\n    // using Google public stun server\n    var configuration1 = {\n      iceServers: [{ urls: \"stun:stun1.1.google.com:19302\" }],\n    };\n    var configuration2 = {\n      iceServers: [{ urls: \"stun:stun2.1.google.com:19302\" }],\n    };\n    var configuration3 = {\n      iceServers: [{ urls: \"stun:stun3.1.google.com:19302\" }],\n    };\n    var configuration4 = {\n      iceServers: [{ urls: \"stun:stun4.1.google.com:19302\" }],\n    };\n\n    const conn1 = new RTCPeerConnection(configuration1);\n    const conn2 = new RTCPeerConnection(configuration2);\n    const conn3 = new RTCPeerConnection(configuration3);\n    const conn4 = new RTCPeerConnection(configuration4);\n\n    //const conn = [conn1, conn2, conn3, conn4];\n\n    console.log(conn1);\n    console.log(conn2);\n\n    const conn = [conn1, conn2, conn3, conn4];\n\n    console.log(conn[0]);\n\n    return conn;\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const listenToConnectionEvents = (\n  conn,\n  username,\n  remoteUsername,\n  database,\n  remoteVideoRef,\n  doCandidate\n) => {\n  console.log(\"In listentoconnectionevents\");\n  conn.onicecandidate = function (event) {\n    if (event.candidate) {\n      doCandidate(remoteUsername, event.candidate, database, username);\n    }\n  };\n\n  // when a remote user adds stream to the peer connection, we display it\n  conn.ontrack = function (e) {\n    if (remoteVideoRef.srcObject !== e.streams[0]) {\n      remoteVideoRef.srcObject = e.streams[0];\n    }\n  };\n};\n\nexport const sendAnswer = async (\n  conn,\n  localStream,\n  notif,\n  doAnswer,\n  database,\n  username\n) => {\n  console.log(\"In sendanswer\");\n  try {\n    conn.addStream(localStream);\n    console.log(\"1\");\n\n    const offer = JSON.parse(notif.offer);\n    console.log(\"2\");\n    conn.setRemoteDescription(offer);\n    console.log(\"3\");\n\n    // create an answer to an offer\n    const answer = await conn.createAnswer();\n    console.log(\"4\");\n    conn.setLocalDescription(answer);\n    console.log(\"5\");\n\n    doAnswer(notif.from, answer, database, username);\n  } catch (exception) {\n    console.error(exception);\n  }\n};\n\nexport const startCall = (yourConn, notif) => {\n  console.log(\"In startcall\");\n  const answer = JSON.parse(notif.answer);\n  yourConn.setRemoteDescription(answer);\n};\n\nexport const addCandidate = (yourConn, notif) => {\n  console.log(\"In addcandidate\");\n  // apply the new received candidate to the connection\n  const candidate = JSON.parse(notif.candidate);\n  yourConn.addIceCandidate(new RTCIceCandidate(candidate));\n};\n"]},"metadata":{},"sourceType":"module"}